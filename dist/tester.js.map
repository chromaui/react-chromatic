{"version":3,"sources":["webpack:///webpack/bootstrap e36f79671cd3b03b5bec","webpack:///external \"babel-runtime/helpers/asyncToGenerator\"","webpack:///external \"babel-runtime/regenerator\"","webpack:///external \"babel-runtime/core-js/promise\"","webpack:///external \"denodeify\"","webpack:///external \"babel-runtime/core-js/json/stringify\"","webpack:///external \"debug\"","webpack:///external \"babel-runtime/helpers/classCallCheck\"","webpack:///external \"babel-runtime/helpers/createClass\"","webpack:///external \"babel-runtime/helpers/extends\"","webpack:///external \"babel-runtime/helpers/toConsumableArray\"","webpack:///external \"child_process\"","webpack:////home/circleci/chromatic/lib/util/GraphQLClient.js","webpack:///./src/assets/environment.js","webpack:///./src/lib/tunnel.js","webpack:///./src/tester/git.js","webpack:///./src/tester/package-json.js","webpack:///./src/tester/runtimes.js","webpack:///./src/tester/start-app.js","webpack:///./package.json","webpack:///external \"env-ci\"","webpack:///external \"node-ask\"","webpack:///external \"tree-kill\"","webpack:///./src/tester/index.js","webpack:///external \"apollo-fetch\"","webpack:///external \"babel-runtime/core-js/object/keys\"","webpack:///external \"babel-runtime/core-js/object/values\"","webpack:///external \"babel-runtime/helpers/slicedToArray\"","webpack:///external \"isomorphic-fetch\"","webpack:///external \"jsdom\"","webpack:///external \"jsonfile\"","webpack:///external \"localtunnel\"","webpack:///external \"path\""],"names":["GraphQLClient","uri","jwtToken","headers","apolloFetch","setJwtToken","use","next","options","authorization","query","variables","data","errors","runQuery","process","env","CHROMATIC_SERVER_PORT","CHROMATIC_INDEX_URL","CHROMATIC_TUNNEL_URL","CHROMATIC_CREATE_TUNNEL","CHROMATIC_APP_CODE","tunnelUrl","port","Error","local_host","host","openTunnel","command","trim","message","match","console","error","execGitCommand","split","commit","committedAtSeconds","committerEmail","committerName","committedAt","getCommit","getBranch","commitExists","limit","firstCommittedAtSeconds","commitsWithBuilds","commitsWithoutBuilds","length","commitsForCLI","debug","c","commits","filter","includes","slice","nextCommits","parentCommits","map","maxCommits","maximallyDescendentCommits","client","candidateCommits","TesterHasBuildsWithCommitsQuery","newCommitsWithBuilds","app","hasBuildsWithCommits","newCommitsWithoutBuilds","find","step","branch","TesterFirstCommittedAtQuery","firstBuild","lastBuild","initialCommitsWithBuilds","extraBaselineCommits","push","FETCH_N_INITIAL_BUILD_COMMITS","getBaselineCommits","join","checkPackageJson","addScriptToPackageJson","appDir","cwd","packageJson","resolve","scripts","script","scriptName","scriptCommand","filename","spaces","addShimsToJSDOM","dom","Object","defineProperty","window","value","matches","addListener","removeListener","LocalStorageMock","store","key","toString","WorkerMock","getRandomValues","navigator","url","verbose","logs","virtualConsole","forEach","on","logType","log","sendTo","fromURL","userAgent","runScripts","resources","pretendToBeVisual","reject","document","addEventListener","separator","__chromaticRuntimeSpecs__","__STORYBOOK_CLIENT_API__","specs","getStorybook","kind","stories","name","runtime","component","input","reduce","a","b","close","getRuntimeSpecs","checkResponse","child","timeoutAt","Date","now","TIMEOUT","resolved","setTimeout","check","CHECK_EVERY","output","stderr","e","stdout","o","waitForResponse","NODE_ENV","BROWSER","startApp","TesterBuildQuery","build","status","inProgressCount","specCount","changeCount","errorCount","lastInProgressCount","pluralize","BUILD_POLL_INTERVAL","waitForBuild","TesterCreateAppTokenMutation","TesterCreateBuildMutation","msg","n","noun","noNumber","pluralizedNoun","appCode","noStart","appPath","only","autoAcceptChanges","exitZeroOnChanges","indexUrl","createTunnel","originalArgv","TRAVIS_EVENT_TYPE","TRAVIS_PULL_REQUEST_SLUG","TRAVIS_REPO_SLUG","warn","createAppToken","isTravisPrBuild","TRAVIS_PULL_REQUEST_SHA","TRAVIS_PULL_REQUEST_BRANCH","HEAD","baselineCommits","appPathWithSlash","appUrl","isolatorUrl","tunnel","predicate","componentName","otherComponentName","runtimeSpecs","fromCI","CI","REPOSITORY_URL","exitCode","packageVersion","createBuild","number","componentCount","webUrl","onlineHint","buildNumber","buildAutoAcceptChanges","pid","replace","confirmed","runTest"],"mappings":"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","file":"dist/tester.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"dist\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 22);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e36f79671cd3b03b5bec","module.exports = require(\"babel-runtime/helpers/asyncToGenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/asyncToGenerator\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"babel-runtime/regenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/regenerator\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/promise\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"denodeify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"denodeify\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/json/stringify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/json/stringify\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"debug\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"debug\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/classCallCheck\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/classCallCheck\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/createClass\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/createClass\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/extends\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/extends\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/toConsumableArray\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/toConsumableArray\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"child_process\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"child_process\"\n// module id = 10\n// module chunks = 0","import { createApolloFetch } from 'apollo-fetch';\n\nexport default class GraphQLClient {\n  constructor({ uri, jwtToken, headers }) {\n    this.apolloFetch = createApolloFetch({ uri });\n    this.headers = headers;\n\n    if (jwtToken) {\n      this.setJwtToken(jwtToken);\n    }\n  }\n\n  setJwtToken(jwtToken) {\n    this.apolloFetch.use(({ options }, next) => {\n      if (jwtToken) {\n        // eslint-disable-next-line no-param-reassign\n        options.headers = {\n          ...options.headers,\n          ...this.headers,\n          authorization: `bearer ${jwtToken}`,\n        };\n      }\n\n      next();\n    });\n  }\n\n  async runQuery(query, variables) {\n    const { data, errors } = await this.apolloFetch({ query, variables });\n    if (errors) {\n      throw errors;\n    }\n    return data;\n  }\n\n  // Convenience static method\n  static async runQuery(options, query, variables) {\n    return new GraphQLClient(options).runQuery(query, variables);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// /home/circleci/chromatic/lib/util/GraphQLClient.js","// Note this file differs from our usual convention because it is packaged\nconst {\n  CHROMATIC_SERVER_PORT = 3004,\n  CHROMATIC_INDEX_URL = 'https://index.chromaticqa.com',\n  CHROMATIC_TUNNEL_URL = 'https://tunnel.chromaticqa.com',\n  CHROMATIC_CREATE_TUNNEL = 'true',\n  CHROMATIC_APP_CODE,\n} = process.env;\n\nexport {\n  CHROMATIC_SERVER_PORT,\n  CHROMATIC_INDEX_URL,\n  CHROMATIC_TUNNEL_URL,\n  CHROMATIC_CREATE_TUNNEL,\n  CHROMATIC_APP_CODE,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/assets/environment.js","import localtunnel from 'localtunnel';\nimport denodeify from 'denodeify';\n\nexport default async function openTunnel({ tunnelUrl, port }) {\n  if (!port) {\n    throw new Error('Need to pass a port into `openTunnel`');\n  }\n\n  return denodeify(localtunnel)(port, {\n    local_host: 'localhost',\n    host: tunnelUrl,\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/tunnel.js","import { exec } from 'child_process';\nimport denodeify from 'denodeify';\nimport setupDebug from 'debug';\n\nconst debug = setupDebug('react-chromatic:tester:git');\n\nasync function execGitCommand(command) {\n  try {\n    return (await denodeify(exec)(command)).trim();\n  } catch (error) {\n    if (error.message && error.message.match('Not a git repository')) {\n      // eslint-disable-next-line no-console\n      console.error(`Unable to execute git command '${command}'.\\n`);\n      // eslint-disable-next-line no-console\n      console.error(\n        'Chromatic only works in git projects.\\n' +\n          'Contact us at support@hichroma.com if you need to use Chromatic outside of one.\\n\\n'\n      );\n    }\n    throw error;\n  }\n}\n\nexport const FETCH_N_INITIAL_BUILD_COMMITS = 20;\n\nconst TesterFirstCommittedAtQuery = `\n  query TesterFirstCommittedAtQuery($branch: String!) {\n    app {\n      firstBuild(sortByCommittedAt: true) {\n        committedAt\n      }\n      lastBuild(branch: $branch, sortByCommittedAt: true) {\n        commit\n        committedAt\n      }\n    }\n  }\n`;\n\nconst TesterHasBuildsWithCommitsQuery = `\n  query TesterHasBuildsWithCommitsQuery($commits: [String!]!) {\n    app {\n      hasBuildsWithCommits(commits: $commits)\n    }\n  }\n`;\n\n// NOTE: At some point we should check that the commit has been pushed to the\n// remote and the branch matches with origin/REF, but for now we are naive about\n// adhoc builds.\n\n// We could cache this, but it's probably pretty quick\nexport async function getCommit() {\n  const [commit, committedAtSeconds, committerEmail, committerName] = (await execGitCommand(\n    `git log -n 1 --format=\"%H,%ct,%ce,%cn\"`\n  )).split(',');\n\n  return { commit, committedAt: committedAtSeconds * 1000, committerEmail, committerName };\n}\n\nexport async function getBranch() {\n  return execGitCommand(`git rev-parse --abbrev-ref HEAD`);\n}\n\n// Check if a commit exists in the repository\nasync function commitExists(commit) {\n  try {\n    await execGitCommand(`git cat-file -e ${commit}^{commit}`);\n    return true;\n  } catch (error) {\n    return false;\n  }\n}\n\nfunction commitsForCLI(commits) {\n  return commits.map(c => c.trim()).join(' ');\n}\n\n// git rev-list in a basic form gives us a list of commits reaching back to\n// `firstCommittedAtSeconds` (i.e. when the first build of this app happened)\n// in reverse chronological order.\n//\n// A simplified version of what we are doing here is just finding the first\n// commit in that list that has a build. We only want to send `limit` to\n// the server in this pass (although we may already know some commits that do\n// or do not have builds from earlier passes). So we just pick the first `limit`\n// commits from the command, filtering out `commitsWith[out]Builds`.\n//\n// However, it's not quite that simple -- because of branching. However,\n// passing commits after `--not` in to `git rev-list` *occludes* all the ancestors\n// of those commits. This is exactly what we need once we find one or more commits\n// that do have builds: a list of the ancestors of HEAD that are not accestors of\n// `commitsWithBuilds`.\n//\nasync function nextCommits(\n  limit,\n  { firstCommittedAtSeconds, commitsWithBuilds, commitsWithoutBuilds }\n) {\n  // We want the next limit commits that aren't \"covered\" by `commitsWithBuilds`\n  // This will print out all commits in `commitsWithoutBuilds` (except if they are covered),\n  // so we ask enough that we'll definitely get `limit` unknown commits\n  const command = `git rev-list HEAD \\\n      ${firstCommittedAtSeconds ? `--since ${firstCommittedAtSeconds}` : ''} \\\n      -n ${limit + commitsWithoutBuilds.length} --not ${commitsForCLI(commitsWithBuilds)}`;\n  debug(`running ${command}`);\n  const commits = (await execGitCommand(command)).split('\\n').filter(c => !!c);\n  debug(`command output: ${commits}`);\n\n  return (\n    commits\n      // No sense in checking commits we already know about\n      .filter(c => !commitsWithBuilds.includes(c))\n      .filter(c => !commitsWithoutBuilds.includes(c))\n      .slice(0, limit)\n  );\n}\n\n// Which of the listed commits are \"maximally descendent\":\n// ie c in commits such that there are no descendents of c in commits.\nasync function maximallyDescendentCommits(commits) {\n  if (commits.length === 0) {\n    return commits;\n  }\n\n  // <commit>^@ expands to all parents of commit\n  const parentCommits = commits.map(c => `${c}^@`);\n  // List the tree from <commits> not including the tree from <parentCommits>\n  // This just filters any commits that are ancestors of other commits\n  const command = `git rev-list ${commitsForCLI(commits)} --not ${commitsForCLI(parentCommits)}`;\n  debug(`running ${command}`);\n  const maxCommits = (await execGitCommand(command)).split('\\n').filter(c => !!c);\n  debug(`command output: ${maxCommits}`);\n\n  return maxCommits;\n}\n\n// Exponentially iterate `limit` up to infinity to find a \"covering\" set of commits with builds\nasync function step(\n  client,\n  limit,\n  { firstCommittedAtSeconds, commitsWithBuilds, commitsWithoutBuilds }\n) {\n  debug(`step: checking ${limit} up to ${firstCommittedAtSeconds}`);\n  debug(`step: commitsWithBuilds: ${commitsWithBuilds}`);\n  debug(`step: commitsWithoutBuilds: ${commitsWithoutBuilds}`);\n\n  const candidateCommits = await nextCommits(limit, {\n    firstCommittedAtSeconds,\n    commitsWithBuilds,\n    commitsWithoutBuilds,\n  });\n\n  debug(`step: candidateCommits: ${candidateCommits}`);\n\n  // No more commits uncovered commitsWithBuilds!\n  if (candidateCommits.length === 0) {\n    debug('step: no candidateCommits; we are done');\n    return commitsWithBuilds;\n  }\n\n  const { app: { hasBuildsWithCommits: newCommitsWithBuilds } } = await client.runQuery(\n    TesterHasBuildsWithCommitsQuery,\n    {\n      commits: candidateCommits,\n    }\n  );\n  debug(`step: newCommitsWithBuilds: ${newCommitsWithBuilds}`);\n\n  const newCommitsWithoutBuilds = candidateCommits.filter(\n    commit => !newCommitsWithBuilds.find(c => c === commit)\n  );\n\n  return step(client, limit * 2, {\n    firstCommittedAtSeconds,\n    commitsWithBuilds: [...commitsWithBuilds, ...newCommitsWithBuilds],\n    commitsWithoutBuilds: [...commitsWithoutBuilds, ...newCommitsWithoutBuilds],\n  });\n}\n\n// eslint-disable-next-line import/prefer-default-export\nexport async function getBaselineCommits(client) {\n  const branch = await getBranch();\n  const { committedAt } = await getCommit();\n\n  // Include the latest build from this branch as an ancestor of the current build\n  const { app: { firstBuild, lastBuild } } = await client.runQuery(TesterFirstCommittedAtQuery, {\n    branch,\n  });\n  debug(`App firstBuild: ${firstBuild}, lastBuild: ${lastBuild}`);\n\n  if (!firstBuild) {\n    debug('App has no builds, returning []');\n    return [];\n  }\n\n  const initialCommitsWithBuilds = [];\n  const extraBaselineCommits = [];\n\n  // Don't do any special branching logic for builds on `HEAD`, this is fairly meaningless\n  // (CI systems that have been pushed tags can not set a branch)\n  if (branch !== 'HEAD' && lastBuild && lastBuild.committedAt <= committedAt) {\n    if (await commitExists(lastBuild.commit)) {\n      initialCommitsWithBuilds.push(lastBuild.commit);\n    } else {\n      debug(`Last build commit not in index, blindly appending to baselines`);\n      extraBaselineCommits.push(lastBuild.commit);\n    }\n  }\n\n  // Get a \"covering\" set of commits that have builds. This is a set of commits\n  // such that any ancestor of HEAD is either:\n  //   - in commitsWithBuilds\n  //   - an ancestor of a commit in commitsWithBuilds\n  //   - has no build\n  const commitsWithBuilds = await step(client, FETCH_N_INITIAL_BUILD_COMMITS, {\n    firstCommittedAtSeconds: firstBuild.committedAt && firstBuild.committedAt / 1000,\n    commitsWithBuilds: initialCommitsWithBuilds,\n    commitsWithoutBuilds: [],\n  });\n\n  debug(`Final commitsWithBuilds: ${commitsWithBuilds}`);\n\n  // For any pair A,B of builds, there is no point in using B if it is an ancestor of A.\n  return [...extraBaselineCommits, ...(await maximallyDescendentCommits(commitsWithBuilds))];\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/git.js","import path from 'path';\nimport { readFileSync, writeFileSync } from 'jsonfile';\n\nexport function checkPackageJson({ appDir = process.cwd() } = {}) {\n  const packageJson = readFileSync(path.resolve(appDir, './package.json'));\n\n  return Object.values(packageJson.scripts || {}).find(script => script.match('chromatic test'));\n}\n\nexport function addScriptToPackageJson(scriptName, scriptCommand, { appDir = process.cwd() } = {}) {\n  const filename = path.resolve(appDir, './package.json');\n  const packageJson = readFileSync(filename);\n\n  if (packageJson[scriptName]) {\n    throw new Error(`Script named '${scriptName}' already exists in package.json`);\n  }\n\n  if (!packageJson.scripts) {\n    packageJson.scripts = {};\n  }\n  packageJson.scripts[scriptName] = scriptCommand;\n  writeFileSync(filename, packageJson, { spaces: 2 });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/package-json.js","/* eslint-disable no-console, class-methods-use-this */\nimport { JSDOM, VirtualConsole } from 'jsdom';\n\nfunction addShimsToJSDOM(dom) {\n  Object.defineProperty(dom.window, 'matchMedia', {\n    value: () => ({\n      matches: true,\n      addListener: () => {},\n      removeListener: () => {},\n    }),\n  });\n\n  class LocalStorageMock {\n    constructor() {\n      this.store = {};\n    }\n    getItem(key) {\n      return this.store[key];\n    }\n    removeItem(key) {\n      delete this.store[key];\n    }\n    setItem(key, value) {\n      this.store[key] = value.toString();\n    }\n    clear() {\n      this.store = {};\n    }\n  }\n  Object.defineProperty(dom.window, 'localStorage', {\n    value: new LocalStorageMock(),\n  });\n\n  class WorkerMock {\n    addEventListener() {}\n    removeEventLister() {}\n    postMessage() {}\n    terminate() {}\n  }\n  Object.defineProperty(dom.window, 'Worker', WorkerMock);\n\n  Object.defineProperty(dom.window, 'crypto', {\n    value: {\n      getRandomValues: () => 0,\n    },\n  });\n\n  Object.defineProperty(dom.window.navigator, 'mimeTypes', {\n    value: () => [],\n  });\n}\n\nexport default async function getRuntimeSpecs(url, { verbose = false } = {}) {\n  const logs = [];\n  const virtualConsole = new VirtualConsole();\n  Object.keys(console).forEach(logType => {\n    virtualConsole.on(logType, log => logs.push({ logType, log }));\n  });\n  virtualConsole.on('jsdomError', log => logs.push({ logType: 'error', log }));\n\n  if (verbose) {\n    virtualConsole.sendTo(console);\n  }\n\n  const dom = await JSDOM.fromURL(url, {\n    userAgent: 'Chromatic',\n    // We need to execute the scripts on the page\n    runScripts: 'dangerously',\n    // We need to load scripts that are loaded via script tags\n    resources: 'usable',\n    // Send console.logs -> /dev/null (so to speak)\n    virtualConsole,\n    // Add a requestAnimationFrame polyfill, react@16 warns about it\n    pretendToBeVisual: true,\n  });\n\n  // NOTE: this line runs immediately after the HTML for the page has been loaded\n  // it's not possible that any external script tags have been executed.\n  // It is possible that they have a <script> tag that need these shims, but\n  // I highly doubt it. If we run into this we can always use JSDOM's old API\n  // to inject our own scripts at 'create' time\n  addShimsToJSDOM(dom);\n\n  return new Promise((resolve, reject) =>\n    dom.window.document.addEventListener('DOMContentLoaded', () => {\n      const separator = '=========================';\n\n      if (!dom.window.__chromaticRuntimeSpecs__ && !dom.window.__STORYBOOK_CLIENT_API__) {\n        console.error(\n          `Didn't find 'window.__chromaticRuntimeSpecs__' at ${url}.\\n` +\n            `Have you installed the Chromatic widget or addon correctly?\\n`\n        );\n\n        if (!verbose && logs.length) {\n          console.error(`Your app's output:\\n${separator}\\n`);\n          logs.forEach(({ logType, log }) => console[logType](log));\n          console.error(`\\n${separator}\\n`);\n        }\n        reject(new Error(`Didn't find 'window.__chromaticRuntimeSpecs__' at ${url}.`));\n      }\n\n      // If their app logged something to console.error, it's probably, but\n      // not definitely an issue. See https://github.com/hichroma/chromatic/issues/757\n      if (logs.find(log => log.logType === 'error')) {\n        console.error(`\\nYour app logged the following to the error console:\\n${separator}`);\n        logs\n          .filter(log => log.logType === 'error')\n          .forEach(({ logType, log }) => console[logType](log));\n        console.error(\n          `\\n${separator}\\nThis may lead to some stories not working right or getting detected by Chromatic` +\n            `\\nWe suggest you fix the errors, but we will continue anyway..\\n`\n        );\n      }\n\n      let specs;\n      if (dom.window.__chromaticRuntimeSpecs__) {\n        specs = dom.window.__chromaticRuntimeSpecs__();\n      } else {\n        specs = dom.window.__STORYBOOK_CLIENT_API__\n          .getStorybook()\n          .map(({ kind, stories }) =>\n            stories.map(({ name }) => ({\n              runtime: 'storybook-no-addon',\n              component: { name: kind },\n              name,\n              input: JSON.stringify({ kind, name }),\n            }))\n          )\n          .reduce((a, b) => [...a, ...b], []);\n      }\n\n      dom.window.close();\n      resolve(specs);\n    })\n  );\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/runtimes.js","import { spawn } from 'child_process';\nimport fetch from 'isomorphic-fetch';\n\nconst CHECK_EVERY = 1000;\nconst TIMEOUT = 5 * 60 * 1000;\n\nexport async function checkResponse(url) {\n  try {\n    await fetch(url);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nasync function waitForResponse(child, url) {\n  const timeoutAt = Date.now() + TIMEOUT;\n  return new Promise((resolve, reject) => {\n    let resolved = false;\n    async function check() {\n      if (Date.now() > timeoutAt) {\n        resolved = true;\n        reject(new Error(`No server responding at ${url} within ${TIMEOUT / 1000} seconds.`));\n        return;\n      }\n\n      if (await checkResponse(url)) {\n        resolved = true;\n        resolve();\n        return;\n      }\n      setTimeout(check, CHECK_EVERY);\n    }\n    check();\n\n    if (child) {\n      let output = '';\n      child.stderr.on('data', e => {\n        output += e.toString();\n      });\n      child.stdout.on('data', o => {\n        output += o.toString();\n      });\n\n      child.on('close', () => {\n        if (!resolved) {\n          reject(new Error(`Script failed to start: ${output}\\n`));\n        }\n      });\n    }\n  });\n}\n\nexport default async function startApp({ scriptName = 'start', url }) {\n  let child;\n  if (scriptName !== 'none') {\n    if (await checkResponse(url)) {\n      throw new Error(\n        `Detected process already running at ${url}` +\n          `\\nIf you are sure this is your server, pass \\`--do-not-start\\` to skip this step.`\n      );\n    }\n\n    child = spawn('npm', ['run', scriptName], {\n      env: {\n        ...process.env,\n        NODE_ENV: 'development',\n        BROWSER: 'none',\n      },\n    });\n  }\n\n  await waitForResponse(child, url);\n  return child;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/start-app.js","module.exports = {\"name\":\"react-chromatic\",\"version\":\"0.8.5-dev\",\"description\":\"Visual Testing for React Components\",\"browser\":\"./dist/client.js\",\"main\":\"./dist/assets/null-server.js\",\"scripts\":{\"prebuild\":\"rm -rf ./dist\",\"build:bin\":\"../../node_modules/.bin/babel -s -d ./dist ./src -D --only 'assets,bin'\",\"build:webpack\":\"../../node_modules/.bin/webpack\",\"build\":\"../../node_modules/.bin/npm-run-all --serial -l build:**\",\"prepare\":\"npm run build\",\"dev\":\"../../node_modules/.bin/npm-run-all --parallel -l 'build:** -- --watch'\"},\"bin\":{\"chromatic\":\"./dist/bin/chromatic.js\"},\"dependencies\":{\"apollo-fetch\":\"^0.6.0\",\"babel-runtime\":\"^6.26.0\",\"commander\":\"^2.9.0\",\"debug\":\"^3.0.1\",\"denodeify\":\"^1.2.1\",\"ejson\":\"^2.1.2\",\"env-ci\":\"^1.5.0\",\"es6-error\":\"^4.0.2\",\"isomorphic-fetch\":\"^2.2.1\",\"jsdom\":\"^11.5.1\",\"jsonfile\":\"^4.0.0\",\"localtunnel\":\"^1.8.3\",\"node-ask\":\"^1.0.1\",\"tree-kill\":\"^1.1.0\"},\"peerDependencies\":{\"react\":\"15.x || 16.x\",\"react-dom\":\"15.x || 16.x\"},\"devDependencies\":{\"babel-cli\":\"^6.26.0\",\"npm-run-all\":\"^4.0.2\",\"prettier-eslint\":\"^7.1.0\",\"tmp\":\"^0.0.33\",\"webpack\":\"^3.10.0\",\"webpack-node-externals\":\"^1.6.0\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./package.json\n// module id = 18\n// module chunks = 0","module.exports = require(\"env-ci\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"env-ci\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"node-ask\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-ask\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"tree-kill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"tree-kill\"\n// module id = 21\n// module chunks = 0","import denodeify from 'denodeify';\nimport { confirm } from 'node-ask';\nimport setupDebug from 'debug';\nimport kill from 'tree-kill';\nimport envCi from 'env-ci';\n\nimport getRuntimeSpecs from './runtimes';\nimport startApp, { checkResponse } from './start-app';\nimport openTunnel from '../lib/tunnel';\nimport { checkPackageJson, addScriptToPackageJson } from './package-json';\nimport GraphQLClient from '../../../../lib/util/GraphQLClient';\nimport { getBaselineCommits, getCommit, getBranch } from './git';\nimport { version as packageVersion } from '../../package.json';\nimport { CHROMATIC_INDEX_URL, CHROMATIC_TUNNEL_URL } from '../assets/environment';\n\nconst BUILD_POLL_INTERVAL = 1000;\n\nconst TesterCreateAppTokenMutation = `\n  mutation TesterCreateAppTokenMutation($appCode: String!) {\n    createAppToken(code: $appCode)\n  }\n`;\n\nconst TesterCreateBuildMutation = `\n  mutation TesterCreateBuildMutation($input: CreateBuildInput!, $isolatorUrl: String!) {\n    createBuild(input: $input, isolatorUrl: $isolatorUrl) {\n      id\n      number\n      specCount\n      componentCount\n      webUrl\n    }\n  }\n`;\n\nconst TesterBuildQuery = `\n  query TesterBuildQuery($buildNumber: Int!) {\n    app {\n      build(number: $buildNumber) {\n        id\n        status\n        autoAcceptChanges\n        inProgressCount: snapshotCount(statuses: [SNAPSHOT_IN_PROGRESS])\n        specCount\n        changeCount\n        errorCount: snapshotCount(statuses: [SNAPSHOT_CAPTURE_ERROR])\n      }\n    }\n  }\n`;\n\nconst debug = setupDebug('react-chromatic:tester');\n\nfunction log(msg) {\n  // eslint-disable-next-line no-console\n  console.log(`Chromatic Tester: ${msg}`);\n}\n\nfunction pluralize(n, noun, noNumber) {\n  const pluralizedNoun = n === 1 ? noun : `${noun}s`;\n\n  return noNumber ? pluralizedNoun : `${n} ${pluralizedNoun}`;\n}\n\nlet lastInProgressCount;\nasync function waitForBuild(client, variables) {\n  const { app: { build } } = await client.runQuery(TesterBuildQuery, variables);\n  debug(`build:${JSON.stringify(build)}`);\n  const { status, inProgressCount, specCount, changeCount, errorCount } = build;\n  if (status === 'BUILD_IN_PROGRESS') {\n    if (inProgressCount !== lastInProgressCount) {\n      lastInProgressCount = inProgressCount;\n      log(\n        `${inProgressCount}/${pluralize(specCount, 'spec')} remain to test. ` +\n          `(${pluralize(changeCount, 'change')}, ${pluralize(errorCount, 'error')})`\n      );\n    }\n\n    await new Promise(resolve => setTimeout(resolve, BUILD_POLL_INTERVAL));\n    return waitForBuild(client, variables);\n  }\n  return build;\n}\n\nexport default async function runTest({\n  appCode,\n  scriptName,\n  noStart = false,\n  port,\n  appPath = '/',\n  url,\n  only,\n  autoAcceptChanges = false,\n  exitZeroOnChanges = false,\n  verbose = false,\n  indexUrl = CHROMATIC_INDEX_URL,\n  tunnelUrl = CHROMATIC_TUNNEL_URL,\n  createTunnel = true,\n  originalArgv = false,\n}) {\n  const uri = `${indexUrl}/graphql`;\n  const client = new GraphQLClient({ uri });\n\n  const { TRAVIS_EVENT_TYPE, TRAVIS_PULL_REQUEST_SLUG, TRAVIS_REPO_SLUG } = process.env;\n  if (TRAVIS_EVENT_TYPE === 'pull_request' && TRAVIS_PULL_REQUEST_SLUG === TRAVIS_REPO_SLUG) {\n    // eslint-disable-next-line no-console\n    console.warn(`WARNING: Running Chromatic on a Travis PR build from an internal branch.\n\nIt is recommended to run Chromatic on the push builds from Travis where possible.\nWe advise turning on push builds and disabling Chromatic for internal PR builds.\nRead more: http://docs.chromaticqa.com/setup_ci#travis\n`);\n  }\n\n  if (!appCode) {\n    throw new Error(\n      'You must provide an app code  -- visit https://www.chromaticqa.com to get your code.' +\n        `\\nPass your app code with the \\`CHROMATIC_APP_CODE\\` environment variable or the \\`--app-code\\` flag.`\n    );\n  }\n\n  if (((!scriptName && !noStart) || !port) && !url) {\n    throw new Error(\n      'You must provide a npm script name (`--script-name`) and port (`--port`) so we can start your app'\n    );\n  }\n\n  try {\n    const { createAppToken: jwtToken } = await client.runQuery(TesterCreateAppTokenMutation, {\n      appCode,\n    });\n    client.setJwtToken(jwtToken);\n  } catch (errors) {\n    if (errors[0] && errors[0].message && errors[0].message.match('No app with code')) {\n      throw new Error(\n        `Incorrect app code '${appCode}' -- visit https://www.chromaticqa.com to get your code`\n      );\n    }\n    throw errors;\n  }\n\n  // eslint-disable-next-line prefer-const\n  let { commit, committedAt, committerEmail, committerName } = await getCommit();\n  let branch = await getBranch();\n  const isTravisPrBuild = process.env.TRAVIS_EVENT_TYPE === 'pull_request';\n\n  // Travis PR builds are weird, we want to ensure we mark build against the commit that was\n  // merged from, rather than the resulting \"psuedo\" merge commit that doesn't stick around in the\n  // history of the project (so approvals will get lost). We also have to ensure we use the right branch.\n  if (isTravisPrBuild) {\n    commit = process.env.TRAVIS_PULL_REQUEST_SHA;\n    branch = process.env.TRAVIS_PULL_REQUEST_BRANCH;\n\n    if (!commit || !branch) {\n      throw new Error(`\\`TRAVIS_EVENT_TYPE\\` environment variable set to 'pull_request', \nbut \\`TRAVIS_PULL_REQUEST_SHA\\` and \\`TRAVIS_PULL_REQUEST_BRANCH\\` are not both set.\n\nRead more here: https://docs.chromaticqa.com/setup_ci#travis`);\n    }\n  }\n\n  // On certain CI systems, a branch is not checked out\n  // (instead a detached head is used for the commit).\n  if (branch === 'HEAD' || !branch) {\n    branch = envCi().branch;\n\n    // $HEAD is for netlify: https://www.netlify.com/docs/continuous-deployment/\n    if (branch === 'HEAD' || !branch) {\n      branch = process.env.HEAD || branch || 'HEAD';\n    }\n  }\n\n  debug(`git info: ${JSON.stringify({ commit, committedAt, branch })}`);\n\n  const baselineCommits = await getBaselineCommits(client);\n  debug(`Found baselineCommits: ${baselineCommits}`);\n\n  const appPathWithSlash = appPath[0] === '/' ? appPath : `/${appPath}`;\n  const appUrl = url || `http://localhost:${port}${appPathWithSlash}`;\n  let child;\n  if (!noStart && !url) {\n    log(`Starting app with \\`npm run ${scriptName}\\``);\n    child = await startApp({ scriptName, url: appUrl });\n    log(`Started app on port ${port}`);\n  } else {\n    if (!await checkResponse(appUrl)) {\n      throw new Error(`No server responding at ${appUrl} -- make sure you've started it.`);\n    }\n    log(`Detected app on port ${port}`);\n  }\n\n  let isolatorUrl = appUrl;\n  let tunnel;\n  if (createTunnel && !url) {\n    log(`Opening tunnel to Chromatic capture servers`);\n    tunnel = await openTunnel({ tunnelUrl, port });\n    debug(`Opened tunnel to ${tunnel.url}`);\n    isolatorUrl = `${tunnel.url}${appPathWithSlash}`;\n  }\n\n  debug(`Connecting to ${isolatorUrl}`);\n  log(`Uploading and verifying build (this may take a few minutes depending on your connection)`);\n\n  let predicate = () => true;\n  if (only) {\n    const match = only.match(/(.*):([^:]*)/);\n    if (!match) {\n      throw new Error(`--only argument must provided in the from \"componentName:specName\"`);\n    }\n    log(`Running only spec '${match[2]}' of component '${match[1]}'`);\n\n    predicate = ({ name, componentName, component: { name: otherComponentName } }) =>\n      name === match[2] && (componentName || otherComponentName) === match[1];\n  }\n\n  const runtimeSpecs = (await getRuntimeSpecs(isolatorUrl, { verbose })).filter(predicate);\n\n  if (runtimeSpecs.length === 0) {\n    throw new Error('Cannot run a build with no specs. Please add some specs!');\n  }\n\n  log(`Found ${runtimeSpecs.length} specs`);\n\n  // REPOSITORY_URL is for netlify: https://www.netlify.com/docs/continuous-deployment/\n  const fromCI = !!process.env.CI || !!process.env.REPOSITORY_URL;\n  debug(`Detected build fromCI:${fromCI}`);\n  debug(`Detected package version:${packageVersion}`);\n\n  let exitCode = 5;\n  try {\n    const { createBuild: { number, specCount, componentCount, webUrl } } = await client.runQuery(\n      TesterCreateBuildMutation,\n      {\n        input: {\n          autoAcceptChanges,\n          branch,\n          commit,\n          committedAt,\n          baselineCommits,\n          runtimeSpecs,\n          fromCI,\n          isTravisPrBuild,\n          packageVersion,\n          committerEmail,\n          committerName,\n        },\n        isolatorUrl,\n      }\n    );\n\n    const onlineHint = `View it online at ${webUrl}`;\n    log(\n      `Started Build ${number} ` +\n        `(${pluralize(componentCount, 'component')}, ${pluralize(specCount, 'spec')}).\n\n${onlineHint}.`\n    );\n\n    const {\n      status,\n      autoAcceptChanges: buildAutoAcceptChanges, // if it is the first build, this may have been set\n      changeCount,\n      errorCount,\n    } = await waitForBuild(client, {\n      buildNumber: number,\n    });\n\n    switch (status) {\n      case 'BUILD_PASSED':\n        log(`Build ${number} passed! ${onlineHint}.`);\n        exitCode = 0;\n        break;\n      // They may have sneakily looked at the build while we were waiting\n      case 'BUILD_ACCEPTED':\n      case 'BUILD_PENDING':\n      case 'BUILD_DENIED':\n        log(`Build ${number} has ${pluralize(changeCount, 'change')}. ${onlineHint}.`);\n        exitCode = exitZeroOnChanges || buildAutoAcceptChanges ? 0 : 1;\n        if (exitCode !== 0) {\n          log(`Pass --exit-zero-on-changes if you want this command to exit successfully in this case.\n  Alternatively, pass --auto-accept-changes if you want changed builds to pass on this branch.\n  Read more: http://docs.chromaticqa.com/test`);\n        }\n        break;\n      case 'BUILD_FAILED':\n        log(`Build ${number} has ${pluralize(errorCount, 'error')}. ${onlineHint}.`);\n        exitCode = 2;\n        break;\n      case 'BUILD_TIMED_OUT':\n        log(\n          `Build ${number} has timed out. Ensure your machine is connected to the internet and please try again.`\n        );\n        exitCode = 3;\n        break;\n      case 'BUILD_ERROR':\n        log(`Build ${number} has failed to run. Our apologies. Please try again.`);\n        exitCode = 4;\n        break;\n      default:\n        throw new Error(`Unexpected build status: ${status}`);\n    }\n  } catch (e) {\n    if (e.length && e[0] && e[0].message.match(/Cannot run a build with no specs./)) {\n      log(e[0].message);\n      exitCode = 255;\n    } else {\n      throw e;\n    }\n  } finally {\n    if (tunnel) {\n      tunnel.close();\n    }\n    if (child) {\n      await denodeify(kill)(child.pid, 'SIGHUP');\n    }\n  }\n\n  if (!checkPackageJson() && originalArgv) {\n    const scriptCommand = `chromatic test ${originalArgv.slice(2).join(' ')}`.replace(\n      /--app-code[= ]\\S+/,\n      ''\n    );\n\n    const confirmed = await confirm(\n      \"\\nYou have not added Chromatic's test script to your `package.json`. Would you like me to do it for you?\"\n    );\n    if (confirmed) {\n      addScriptToPackageJson('chromatic', scriptCommand);\n      // eslint-disable-next-line no-console\n      console.log(\n        '\\nAdded script `chromatic`. You can now run it here or in CI with `npm run chromatic` (or `yarn chromatic`)'\n      );\n    } else {\n      // eslint-disable-next-line no-console\n      console.log(`\nNo problem. You can add it later with:\n{\n  \"scripts\": {\n    \"chromatic\": \"${scriptCommand}\"\n  }\n}`);\n    }\n\n    // eslint-disable-next-line no-console\n    console.log(\n      `\\nMake sure you set the \\`CHROMATIC_APP_CODE\\` environment variable when running builds (in particular on your CI server).`\n    );\n  }\n\n  return exitCode;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/index.js","module.exports = require(\"apollo-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"apollo-fetch\"\n// module id = 23\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/object/keys\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/keys\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/object/values\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/values\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/slicedToArray\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/slicedToArray\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"isomorphic-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-fetch\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"jsdom\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsdom\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"jsonfile\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonfile\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"localtunnel\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"localtunnel\"\n// module id = 30\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 31\n// module chunks = 0"],"sourceRoot":""}