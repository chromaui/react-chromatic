{"version":3,"sources":["webpack:///webpack/bootstrap 76455e1393c42c0d6f80","webpack:///external \"babel-runtime/helpers/asyncToGenerator\"","webpack:///external \"babel-runtime/regenerator\"","webpack:///external \"babel-runtime/core-js/promise\"","webpack:///external \"denodeify\"","webpack:///./src/environment.js","webpack:///external \"debug\"","webpack:///external \"babel-runtime/helpers/classCallCheck\"","webpack:///external \"babel-runtime/helpers/createClass\"","webpack:///external \"babel-runtime/helpers/extends\"","webpack:///external \"child_process\"","webpack:////home/circleci/chromatic/lib/util/GraphQLClient.js","webpack:///./src/lib/tunnel.js","webpack:///./src/tester/git.js","webpack:///./src/tester/package-json.js","webpack:///./src/tester/runtimes.js","webpack:///./src/tester/start-app.js","webpack:///external \"babel-runtime/core-js/json/stringify\"","webpack:///external \"node-ask\"","webpack:///external \"tree-kill\"","webpack:///./src/tester/index.js","webpack:///./src/tester/resource-loader.js","webpack:///external \"apollo-fetch\"","webpack:///external \"babel-runtime/core-js/object/assign\"","webpack:///external \"babel-runtime/core-js/object/keys\"","webpack:///external \"babel-runtime/core-js/object/values\"","webpack:///external \"babel-runtime/helpers/slicedToArray\"","webpack:///external \"babel-runtime/helpers/toConsumableArray\"","webpack:///external \"content-type-parser\"","webpack:///external \"html-encoding-sniffer\"","webpack:///external \"isomorphic-fetch\"","webpack:///external \"jsdom\"","webpack:///external \"jsdom/lib/jsdom/browser/resource-loader\"","webpack:///external \"jsdom/lib/old-api\"","webpack:///external \"jsonfile\"","webpack:///external \"localtunnel\"","webpack:///external \"path\"","webpack:///external \"progress\"","webpack:///external \"request\"","webpack:///external \"util\"","webpack:///external \"whatwg-encoding\""],"names":["process","env","CHROMATIC_SERVER_PORT","CHROMATIC_INDEX_URL","CHROMATIC_TUNNEL_URL","GraphQLClient","uri","jwtToken","apolloFetch","setJwtToken","use","next","options","headers","authorization","query","variables","data","errors","runQuery","port","Error","local_host","host","openTunnel","command","trim","console","error","message","match","execGitCommand","split","commit","committedAtSeconds","committedAt","getCommit","branch","CI_BRANCH","getBranch","commits","map","c","join","boundaryData","baselineCommits","oldestCommittedAt","filter","l","forEach","rawRow","commitWithDash","slice","find","push","Math","min","getBaselinesFromCommits","client","currentCommit","TesterGetRecentBuildCommitsQuery","newestCommittedAt","recentCommits","app","buildCommits","debug","FETCH_N_INITAL_BUILD_COMMITS","length","recentBaselineCommits","TesterGetAllPossibleBuildCommitsQuery","allPossibleCommits","getBaselineCommits","checkPackageJson","addScriptToPackageJson","appDir","cwd","packageJson","resolve","scripts","script","scriptName","scriptCommand","filename","spaces","addShimsToJSDOM","window","Object","defineProperty","value","matches","addListener","removeListener","LocalStorageMock","store","key","toString","WorkerMock","getRandomValues","url","verbose","logs","virtualConsole","on","logType","log","sendTo","resourceLoader","features","FetchExternalResources","ProcessExternalResources","SkipExternalResources","created","reject","document","addEventListener","__chromaticRuntimeSpecs__","separator","specs","close","getRuntimeSpecs","checkResponse","child","timeoutAt","Date","now","TIMEOUT","resolved","setTimeout","check","CHECK_EVERY","output","stderr","e","stdout","o","waitForResponse","NODE_ENV","BROWSER","startApp","TesterBuildQuery","build","status","inProgressCount","specCount","changeCount","errorCount","lastInProgressCount","pluralize","BUILD_POLL_INTERVAL","waitForBuild","TesterCreateAppTokenMutation","TesterCreateBuildMutation","msg","n","noun","noNumber","pluralizedNoun","appCode","noStart","appPath","exitZeroOnChanges","indexUrl","createTunnel","originalArgv","createAppToken","appPathWithSlash","isolatorUrl","tunnel","runtimeSpecs","exitCode","input","createBuild","number","componentCount","webUrl","onlineHint","buildNumber","pid","replace","confirmed","runTest","IS_BROWSER","prototype","call","logRequest","req","len","parseInt","res","bar","path","complete","incomplete","width","total","tick","chunk","callback","element","_ownerDocument","cookieJar","_cookieJar","accept","_accept","referrer","URL","pool","_pool","agentOptions","_agentOptions","strictSSL","_strictSSL","proxy","_proxy","userAgent","_defaultView","navigator","requestOptions","agent","agentClass","gzip","jar","encoding","Accept","referer","defaultEncoding","detectMetaCharset","response","bufferData","contentType","sniffOptions","transportLayerEncodingLabel","get","getBOMEncoding","labelToName","decoded","decode","set","originalRequest","abort","isAbortError"],"mappings":"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","file":"dist/tester.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"dist\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 19);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 76455e1393c42c0d6f80","module.exports = require(\"babel-runtime/helpers/asyncToGenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/asyncToGenerator\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"babel-runtime/regenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/regenerator\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/promise\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"denodeify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"denodeify\"\n// module id = 3\n// module chunks = 0","// Note this file differs from our usual convention because it is packaged\nconst {\n  CHROMATIC_SERVER_PORT = 3004,\n  CHROMATIC_INDEX_URL = 'https://index.chromaticqa.com',\n  CHROMATIC_TUNNEL_URL = 'https://tunnel.chromaticqa.com',\n} = process.env;\n\nexport { CHROMATIC_SERVER_PORT, CHROMATIC_INDEX_URL, CHROMATIC_TUNNEL_URL };\n\n\n\n// WEBPACK FOOTER //\n// ./src/environment.js","module.exports = require(\"debug\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"debug\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/classCallCheck\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/classCallCheck\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/createClass\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/createClass\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/extends\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/extends\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"child_process\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"child_process\"\n// module id = 9\n// module chunks = 0","import { createApolloFetch } from 'apollo-fetch';\n\nexport default class GraphQLClient {\n  constructor({ uri, jwtToken }) {\n    this.apolloFetch = createApolloFetch({ uri });\n\n    if (jwtToken) {\n      this.setJwtToken(jwtToken);\n    }\n  }\n\n  setJwtToken(jwtToken) {\n    this.apolloFetch.use(({ options }, next) => {\n      if (jwtToken) {\n        // eslint-disable-next-line no-param-reassign\n        options.headers = {\n          ...options.headers,\n          authorization: `bearer ${jwtToken}`,\n        };\n      }\n\n      next();\n    });\n  }\n\n  async runQuery(query, variables) {\n    const { data, errors } = await this.apolloFetch({ query, variables });\n    if (errors) {\n      throw errors;\n    }\n    return data;\n  }\n\n  // Convenience static method\n  static async runQuery(options, query, variables) {\n    return new GraphQLClient(options).runQuery(query, variables);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// /home/circleci/chromatic/lib/util/GraphQLClient.js","import localtunnel from 'localtunnel';\nimport denodeify from 'denodeify';\n\nimport { CHROMATIC_TUNNEL_URL } from '../environment';\n\nexport default async function openTunnel({ port }) {\n  if (!port) {\n    throw new Error('Need to pass a port into `openTunnel`');\n  }\n\n  return denodeify(localtunnel)(port, {\n    local_host: 'localhost',\n    host: CHROMATIC_TUNNEL_URL,\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/tunnel.js","import { exec } from 'child_process';\nimport denodeify from 'denodeify';\nimport setupDebug from 'debug';\n\nconst debug = setupDebug('react-chromatic:tester:git');\n\nasync function execGitCommand(command) {\n  try {\n    return (await denodeify(exec)(command)).trim();\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(`Unable to execute git command '${command}'.\\n`);\n    if (error.message && error.message.match('Not a git repository')) {\n      // eslint-disable-next-line no-console\n      console.error(\n        'Chromatic only works in git projects.\\n' +\n          'Contact us at support@hichroma.com if you need to use Chromatic outside of one.\\n\\n'\n      );\n    }\n    throw error;\n  }\n}\n\nexport const FETCH_N_INITAL_BUILD_COMMITS = 20;\nconst TesterGetRecentBuildCommitsQuery = `\n  query TesterGetRecentBuildCommitsQuery($newestCommittedAt: Float!) {\n    app {\n      buildCommits(limit: ${FETCH_N_INITAL_BUILD_COMMITS}, newestCommittedAt: $newestCommittedAt)\n    }\n  }\n`;\n\nconst TesterGetAllPossibleBuildCommitsQuery = `\n  query TesterGetAllPossibleBuildCommitsQuery($newestCommittedAt: Float!, $oldestCommittedAt: Float!) {\n    app {\n      buildCommits(skip: ${FETCH_N_INITAL_BUILD_COMMITS}, newestCommittedAt: $newestCommittedAt, oldestCommittedAt: $oldestCommittedAt)\n    }\n  }\n`;\n\n// NOTE: At some point we should check that the commit has been pushed to the\n// remote and the branch matches with origin/REF, but for now we are naive about\n// adhoc builds.\n\nexport async function getCommit() {\n  const [commit, committedAtSeconds] = (await execGitCommand(`git log -n 1 --format=\"%H %ct\"`))\n    .trim()\n    .split(' ');\n\n  return { commit, committedAt: committedAtSeconds * 1000 };\n}\n\nexport async function getBranch() {\n  const branch = (await execGitCommand(`git rev-parse --abbrev-ref HEAD`)).trim();\n\n  // On certain CI systems, a branch is not checked out (instead a detached head)\n  // is used for the commit. We can use this environment variable in such cases:\n  //   https://documentation.codeship.com/pro/builds-and-configuration/environment-variables/#default-environment-variables\n  if (branch === 'HEAD') {\n    return process.env.CI_BRANCH || branch;\n  }\n  return branch;\n}\n\n// We use rev-list to get all the commits that are ancestors of HEAD but not\n// ancestors of any of the <commits>.\n//\n// These commits naturally form a tree that meets up to the complete history of\n// <commits> (call that the \"known\" history, from chromatic's perspective).\n// git calls the commits in the known history where the tree joins the \"boundary\".\n// Of the boundary commits:\n//   - Those that are actually members of <commits> correspond to builds that\n//     we want to use as a baseline\n//   - Otherwise they correspond to commits in the known history that we have\n//     commit path to but no known build on that path.\n//\n// We are just going to follow a simple algorithm: on the first pass, grab\n// X commits, check which are boundaries. If there are boundaries not in those\n// commits, choose the *oldest*, and grab all builds that are more recent.\n// In the second pass we do not care which\nasync function getBaselinesFromCommits(commits) {\n  const boundaryData = await execGitCommand(\n    `git rev-list HEAD --boundary --format='%m%H %ct' --ignore-missing \\\n      --not ${commits.map(c => c.trim()).join(' ')}`\n  );\n\n  const baselineCommits = [];\n  let oldestCommittedAt = null;\n  boundaryData\n    .trim()\n    .split('\\n')\n    // rev-list lists each commit like:\n    // commit 4a1c922edd61fa0e9d3cb25d4e205816701557a5\n    // >4a1c922edd61fa0e9d3cb25d4e205816701557a5 1495065352\n    // We want the second line if it matches (\"-\")\n    .filter(l => !l.match('commit') && l.match('-'))\n    .forEach(rawRow => {\n      const [commitWithDash, committedAtSeconds] = rawRow.trim().split(' ');\n      const commit = commitWithDash.slice(1);\n\n      if (commits.find(c => c === commit)) {\n        baselineCommits.push(commit);\n      } else if (oldestCommittedAt === null) {\n        oldestCommittedAt = committedAtSeconds * 1000;\n      } else {\n        oldestCommittedAt = Math.min(oldestCommittedAt, committedAtSeconds * 1000);\n      }\n    });\n\n  return {\n    baselineCommits,\n    oldestCommittedAt,\n  };\n}\n\n// eslint-disable-next-line import/prefer-default-export\nexport async function getBaselineCommits(client) {\n  // NOTE: the rev-list command above doesn't work in the case that the last\n  // commit is exactly this commit. However this is easy for us to deal with!\n  const { commit: currentCommit, committedAt } = await getCommit();\n\n  // Get the (up to) X commits of the most recent builds of this app\n  const recentCommits = (await client.runQuery(TesterGetRecentBuildCommitsQuery, {\n    newestCommittedAt: committedAt,\n  })).app.buildCommits;\n  debug(`First ${FETCH_N_INITAL_BUILD_COMMITS} commits: ${recentCommits}`);\n\n  // Short-circuit: on first run, there's definitely no baseline!\n  if (recentCommits.length === 0) {\n    return [];\n  }\n\n  if (recentCommits.find(c => c === currentCommit)) {\n    return [currentCommit];\n  }\n\n  const {\n    baselineCommits: recentBaselineCommits,\n    oldestCommittedAt,\n  } = await getBaselinesFromCommits(recentCommits);\n  debug(`Baselines from initial commits: ${recentBaselineCommits} [${oldestCommittedAt}]`);\n\n  // console.log(recentBaselineCommits, oldestCommittedAt);\n  // Important optimization. If we are sure that there aren't any older relevant\n  // builds, we can avoid an extra query\n  if (oldestCommittedAt === null || recentCommits.length < FETCH_N_INITAL_BUILD_COMMITS) {\n    return recentBaselineCommits;\n  }\n\n  // We aren't sure we know everything, so run a (potentially) more expensive query\n  // to get *all* builds that are newer than oldestCommittedAt\n  const allPossibleCommits = (await client.runQuery(TesterGetAllPossibleBuildCommitsQuery, {\n    newestCommittedAt: committedAt,\n    oldestCommittedAt,\n  })).app.buildCommits;\n  debug(`allPossibleCommits: ${allPossibleCommits}`);\n\n  const { baselineCommits } = await getBaselinesFromCommits([\n    ...recentCommits,\n    ...allPossibleCommits,\n  ]);\n  debug(`allPossible baselineCommits: ${baselineCommits}`);\n  return baselineCommits;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/git.js","import path from 'path';\nimport { readFileSync, writeFileSync } from 'jsonfile';\n\nexport function checkPackageJson({ appDir = process.cwd() } = {}) {\n  const packageJson = readFileSync(path.resolve(appDir, './package.json'));\n\n  return Object.values(packageJson.scripts || {}).find(script => script.match('chromatic test'));\n}\n\nexport function addScriptToPackageJson(scriptName, scriptCommand, { appDir = process.cwd() } = {}) {\n  const filename = path.resolve(appDir, './package.json');\n  const packageJson = readFileSync(filename);\n\n  if (packageJson[scriptName]) {\n    throw new Error(`Script named '${scriptName}' already exists in package.json`);\n  }\n\n  if (!packageJson.scripts) {\n    packageJson.scripts = {};\n  }\n  packageJson.scripts[scriptName] = scriptCommand;\n  writeFileSync(filename, packageJson, { spaces: 2 });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/package-json.js","/* eslint-disable no-console, class-methods-use-this */\nimport { VirtualConsole } from 'jsdom';\nimport { env } from 'jsdom/lib/old-api';\nimport { promisify } from 'util';\n\nimport resourceLoader from './resource-loader';\n\nfunction addShimsToJSDOM(window) {\n  Object.defineProperty(window, 'matchMedia', {\n    value: () => ({\n      matches: true,\n      addListener: () => {},\n      removeListener: () => {},\n    }),\n  });\n\n  class LocalStorageMock {\n    constructor() {\n      this.store = {};\n    }\n    getItem(key) {\n      return this.store[key];\n    }\n    removeItem(key) {\n      delete this.store[key];\n    }\n    setItem(key, value) {\n      this.store[key] = value.toString();\n    }\n    clear() {\n      this.store = {};\n    }\n  }\n  Object.defineProperty(window, 'localStorage', {\n    value: new LocalStorageMock(),\n  });\n\n  class WorkerMock {\n    addEventListener() {}\n    removeEventLister() {}\n    postMessage() {}\n    terminate() {}\n  }\n  Object.defineProperty(window, 'Worker', WorkerMock);\n\n  Object.defineProperty(window, 'crypto', {\n    value: {\n      getRandomValues: () => 0,\n    },\n  });\n}\n\nexport default async function getRuntimeSpecs(url, { verbose = false } = {}) {\n  const logs = [];\n  const virtualConsole = new VirtualConsole();\n  Object.keys(console).forEach(logType => {\n    virtualConsole.on(logType, log => logs.push({ logType, log }));\n  });\n  virtualConsole.on('jsdomError', log => logs.push({ logType: 'error', log }));\n\n  if (verbose) {\n    virtualConsole.sendTo(console);\n  }\n\n  const window = await promisify(created => {\n    env({\n      url,\n      virtualConsole,\n      resourceLoader,\n      features: {\n        FetchExternalResources: ['script'],\n        ProcessExternalResources: ['script'],\n        SkipExternalResources: false,\n      },\n      created,\n    });\n  })();\n\n  addShimsToJSDOM(window);\n\n  return new Promise((resolve, reject) =>\n    window.document.addEventListener('DOMContentLoaded', () => {\n      if (!window.__chromaticRuntimeSpecs__) {\n        console.error(\n          `Didn't find 'window.__chromaticRuntimeSpecs__' at ${url}.\\n` +\n            `Have you installed the Chromatic widget or addon correctly?\\n`\n        );\n\n        if (!verbose && logs.length) {\n          const separator = '=========================';\n          console.error(`Your app's output:\\n${separator}\\n`);\n          logs.forEach(({ logType, log }) => console[logType](log));\n          console.error(`\\n${separator}\\n`);\n        }\n        reject(new Error(`Didn't find 'window.__chromaticRuntimeSpecs__' at ${url}.`));\n      }\n      const specs = window.__chromaticRuntimeSpecs__();\n      window.close();\n      resolve(specs);\n    })\n  );\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/runtimes.js","import { spawn } from 'child_process';\nimport fetch from 'isomorphic-fetch';\n\nconst CHECK_EVERY = 1000;\nconst TIMEOUT = 5 * 60 * 1000;\n\nexport async function checkResponse(url) {\n  try {\n    await fetch(url);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nasync function waitForResponse(child, url) {\n  const timeoutAt = Date.now() + TIMEOUT;\n  return new Promise((resolve, reject) => {\n    let resolved = false;\n    async function check() {\n      if (Date.now() > timeoutAt) {\n        resolved = true;\n        reject(new Error(`No server responding at ${url} within ${TIMEOUT / 1000} seconds.`));\n        return;\n      }\n\n      if (await checkResponse(url)) {\n        resolved = true;\n        resolve();\n        return;\n      }\n      setTimeout(check, CHECK_EVERY);\n    }\n    check();\n\n    if (child) {\n      let output = '';\n      child.stderr.on('data', e => {\n        output += e.toString();\n      });\n      child.stdout.on('data', o => {\n        output += o.toString();\n      });\n\n      child.on('close', () => {\n        if (!resolved) {\n          reject(new Error(`Script failed to start: ${output}\\n`));\n        }\n      });\n    }\n  });\n}\n\nexport default async function startApp({ scriptName = 'start', url }) {\n  let child;\n  if (scriptName !== 'none') {\n    if (await checkResponse(url)) {\n      throw new Error(`Detected process already running at ${url}`);\n    }\n\n    child = spawn('npm', ['run', scriptName], {\n      env: {\n        ...process.env,\n        NODE_ENV: 'development',\n        BROWSER: 'none',\n      },\n    });\n  }\n\n  await waitForResponse(child, url);\n  return child;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/start-app.js","module.exports = require(\"babel-runtime/core-js/json/stringify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/json/stringify\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"node-ask\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-ask\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"tree-kill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"tree-kill\"\n// module id = 18\n// module chunks = 0","import denodeify from 'denodeify';\nimport { confirm } from 'node-ask';\nimport setupDebug from 'debug';\nimport kill from 'tree-kill';\n\nimport { CHROMATIC_INDEX_URL } from '../environment';\nimport getRuntimeSpecs from './runtimes';\nimport startApp, { checkResponse } from './start-app';\nimport openTunnel from '../lib/tunnel';\nimport { checkPackageJson, addScriptToPackageJson } from './package-json';\nimport GraphQLClient from '../../../../lib/util/GraphQLClient';\nimport { getBaselineCommits, getCommit, getBranch } from './git';\n\nconst BUILD_POLL_INTERVAL = 1000;\n\nconst TesterCreateAppTokenMutation = `\n  mutation TesterCreateAppTokenMutation($appCode: String!) {\n    createAppToken(code: $appCode)\n  }\n`;\n\nconst TesterCreateBuildMutation = `\n  mutation TesterCreateBuildMutation($input: CreateBuildInput!, $isolatorUrl: String!) {\n    createBuild(input: $input, isolatorUrl: $isolatorUrl) {\n      id\n      number\n      specCount\n      componentCount\n      webUrl\n    }\n  }\n`;\n\nconst TesterBuildQuery = `\n  query TesterBuildQuery($buildNumber: Int!) {\n    app {\n      build(number: $buildNumber) {\n        id\n        status\n        inProgressCount: snapshotCount(status: SNAPSHOT_IN_PROGRESS)\n        specCount\n        changeCount: snapshotCount(change: SNAPSHOT_VISUALLY_DIFFERENT)\n        errorCount: snapshotCount(status: SNAPSHOT_CAPTURE_ERROR)\n      }\n    }\n  }\n`;\n\nconst debug = setupDebug('react-chromatic:tester');\n\nfunction log(msg) {\n  // eslint-disable-next-line no-console\n  console.log(`Chromatic Tester: ${msg}`);\n}\n\nfunction pluralize(n, noun, noNumber) {\n  const pluralizedNoun = n === 1 ? noun : `${noun}s`;\n\n  return noNumber ? pluralizedNoun : `${n} ${pluralizedNoun}`;\n}\n\nlet lastInProgressCount;\nasync function waitForBuild(client, variables) {\n  const { app: { build } } = await client.runQuery(TesterBuildQuery, variables);\n  debug(`build:${JSON.stringify(build)}`);\n  const { status, inProgressCount, specCount, changeCount, errorCount } = build;\n  if (status === 'BUILD_IN_PROGRESS') {\n    if (inProgressCount !== lastInProgressCount) {\n      lastInProgressCount = inProgressCount;\n      log(\n        `${inProgressCount}/${pluralize(specCount, 'spec')} remain to test. ` +\n          `(${pluralize(changeCount, 'change')}, ${pluralize(errorCount, 'error')})`\n      );\n    }\n\n    await new Promise(resolve => setTimeout(resolve, BUILD_POLL_INTERVAL));\n    return waitForBuild(client, variables);\n  }\n  return build;\n}\n\nexport default async function runTest({\n  appCode,\n  scriptName,\n  noStart = false,\n  port,\n  appPath = '/',\n  exitZeroOnChanges = false,\n  verbose = false,\n  indexUrl = CHROMATIC_INDEX_URL,\n  createTunnel = true,\n  originalArgv = false,\n}) {\n  const uri = `${indexUrl}/graphql`;\n  const client = new GraphQLClient({ uri });\n\n  if (!appCode) {\n    throw new Error(\n      'You must provide an app code  -- visit https://chromaticqa.com to get your code.' +\n        `\\nPass your app code with the \\`CHROMATIC_APP_CODE\\` environment variable or the \\`--app-code\\` flag.`\n    );\n  }\n\n  if ((!scriptName && !noStart) || !port) {\n    throw new Error(\n      'You must provide a npm script name (`--script-name`) and port (`--port`) so we can start your app'\n    );\n  }\n\n  try {\n    const { createAppToken: jwtToken } = await client.runQuery(TesterCreateAppTokenMutation, {\n      appCode,\n    });\n    client.setJwtToken(jwtToken);\n  } catch (errors) {\n    if (errors[0] && errors[0].message && errors[0].message.match('No app with code')) {\n      throw new Error(\n        `Incorrect app code '${appCode}' -- visit https://chromaticqa.com to get your code`\n      );\n    }\n    throw errors;\n  }\n\n  const { commit, committedAt } = await getCommit();\n  const branch = await getBranch();\n  debug(`git info: ${JSON.stringify({ commit, committedAt, branch })}`);\n\n  const baselineCommits = await getBaselineCommits(client);\n  debug(`Found baselineCommits: ${baselineCommits}`);\n\n  const appPathWithSlash = appPath[0] === '/' ? appPath : `/${appPath}`;\n  const url = `http://localhost:${port}${appPathWithSlash}`;\n  let child;\n  if (!noStart) {\n    log(`Starting app with \\`npm run ${scriptName}\\``);\n    child = await startApp({ scriptName, url });\n    log(`Started app on port ${port}`);\n  } else {\n    if (!await checkResponse(url)) {\n      throw new Error(`Did not attempt app running at ${url} -- make sure you've started it.`);\n    }\n    log(`Detected app on port ${port}`);\n  }\n\n  let isolatorUrl = url;\n  let tunnel;\n  if (createTunnel) {\n    log(`Opening tunnel to Chromatic capture servers`);\n    tunnel = await openTunnel({ port });\n    debug(`Opened tunnel to ${tunnel.url}`);\n    isolatorUrl = `${tunnel.url}${appPathWithSlash}`;\n  }\n\n  debug(`Connecting to ${isolatorUrl}`);\n  log(`Uploading and verifying build (this may take a few minutes depending on your connection)`);\n  const runtimeSpecs = await getRuntimeSpecs(isolatorUrl, { verbose });\n  log(`Found ${runtimeSpecs.length} specs`);\n\n  let exitCode = 5;\n  try {\n    const {\n      createBuild: { number, specCount, componentCount, webUrl },\n    } = await client.runQuery(TesterCreateBuildMutation, {\n      input: {\n        branch,\n        commit,\n        committedAt,\n        baselineCommits,\n        runtimeSpecs,\n      },\n      isolatorUrl,\n    });\n\n    const onlineHint = `View it online at ${webUrl}`;\n    log(\n      `Started Build ${number} ` +\n        `(${pluralize(componentCount, 'component')}, ${pluralize(specCount, 'spec')}).\n\n${onlineHint}.`\n    );\n\n    const { status, changeCount, errorCount } = await waitForBuild(client, {\n      buildNumber: number,\n    });\n\n    switch (status) {\n      case 'BUILD_PASSED':\n        log(`Build ${number} passed! ${onlineHint}.`);\n        exitCode = 0;\n        break;\n      // They may have sneakily looked at the build while we were waiting\n      case 'BUILD_PENDING':\n      case 'BUILD_ACCEPTED':\n      case 'BUILD_DENIED':\n        log(`Build ${number} has ${pluralize(changeCount, 'change')}. ${onlineHint}.`);\n        if (!exitZeroOnChanges) {\n          log(\n            `Pass --exit-zero-on-changes if you want this command to exit successfully in this case. Read more: http://docs.chromaticqa.com/setup_ci`\n          );\n        }\n        exitCode = exitZeroOnChanges ? 0 : 1;\n        break;\n      case 'BUILD_FAILED':\n        log(`Build ${number} has ${pluralize(errorCount, 'error')}. ${onlineHint}.`);\n        exitCode = 2;\n        break;\n      case 'BUILD_TIMED_OUT':\n        log(\n          `Build ${number} has timed out. Ensure your machine is connected to the internet and please try again.`\n        );\n        exitCode = 3;\n        break;\n      case 'BUILD_ERROR':\n        log(`Build ${number} has failed to run. Our apologies. Please try again.`);\n        exitCode = 4;\n        break;\n      default:\n        throw new Error(`Unexpected build status: ${status}`);\n    }\n  } catch (e) {\n    if (e.length && e[0] && e[0].message.match(/Cannot run a build with no specs./)) {\n      log(e[0].message);\n      exitCode = 255;\n    } else {\n      throw e;\n    }\n  } finally {\n    if (tunnel) {\n      tunnel.close();\n    }\n    if (child) {\n      await denodeify(kill)(child.pid, 'SIGHUP');\n    }\n  }\n\n  if (!checkPackageJson() && originalArgv) {\n    const scriptCommand = `chromatic test ${originalArgv.slice(2).join(' ')}`.replace(\n      /--app-code[= ]\\S+/,\n      ''\n    );\n\n    const confirmed = await confirm(\n      \"\\nYou have not added Chromatic's test script to your `package.json`. Would you like me to do it for you?\"\n    );\n    if (confirmed) {\n      addScriptToPackageJson('chromatic', scriptCommand);\n      // eslint-disable-next-line no-console\n      console.log(\n        '\\nAdded script `chromatic`. You can now run it here or in CI with `npm run chromatic` (or `yarn chromatic`)'\n      );\n    } else {\n      // eslint-disable-next-line no-console\n      console.log(`\nNo problem. You can add it later with:\n{\n  \"scripts\": {\n    \"chromatic\": \"${scriptCommand}\"\n  }\n}`);\n    }\n\n    // eslint-disable-next-line no-console\n    console.log(\n      `\\nMake sure you set the \\`CHROMATIC_APP_CODE\\` environment variable when running builds (in particular on your CI server).`\n    );\n  }\n\n  return exitCode;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/index.js","/* eslint-disable no-underscore-dangle */\n\nimport parseContentType from 'content-type-parser';\nimport sniffHTMLEncoding from 'html-encoding-sniffer';\nimport whatwgEncoding from 'whatwg-encoding';\nimport request from 'request';\nimport ProgressBar from 'progress';\nimport { wrapCookieJarForRequest } from 'jsdom/lib/jsdom/browser/resource-loader';\n\nconst IS_BROWSER = Object.prototype.toString.call(process) !== '[object process]';\n\nfunction logRequest(req) {\n  req.on('response', res => {\n    const len = parseInt(res.headers['content-length'], 10);\n\n    console.log();\n    const bar = new ProgressBar(` downloading ${req.uri.path} [:bar] :percent :etas`, {\n      complete: '=',\n      incomplete: ' ',\n      width: 20,\n      total: len,\n    });\n\n    res.on('data', chunk => {\n      bar.tick(chunk.length);\n    });\n\n    res.on('end', () => {\n      console.log('\\n');\n    });\n  });\n}\n\nexport default function resourceLoader({ element, url }, callback) {\n  // Copied and adapted from\n  // https://github.com/tmeasday/jsdom/blob/fd2cccfeb3eb28d59b79d17821c5ceabd3077083/lib/jsdom/browser/resource-loader.js#L223-L247\n  const document = element._ownerDocument;\n\n  const cookieJar = document._cookieJar;\n\n  // NOTE: this should be passed into `resourceLoader.load` and extended, but\n  // we do not have access to the original object. See below:\n  const options = {};\n  options.accept = element._accept;\n  options.cookieJar = cookieJar;\n  options.referrer = document.URL;\n  options.pool = document._pool;\n  options.agentOptions = document._agentOptions;\n  options.strictSSL = document._strictSSL;\n  options.proxy = document._proxy;\n  options.userAgent = document._defaultView.navigator.userAgent;\n\n  // Copied and adapted from\n  // https://github.com/tmeasday/jsdom/blob/fd2cccfeb3eb28d59b79d17821c5ceabd3077083/lib/jsdom/browser/resource-loader.js#L158-L219\n  // *NOTE*: we do not have access to the following options that may be passed\n  // into `resourceLoader.load`, that are used below:\n  //  - options.headers\n  //  - options.agent\n  //  - options.agentClass\n  //  - options.defaultEncoding\n  //  - options.detectMetaCharset\n  const requestOptions = {\n    pool: options.pool,\n    agent: options.agent,\n    agentOptions: options.agentOptions,\n    agentClass: options.agentClass,\n    strictSSL: options.strictSSL,\n    gzip: true,\n    jar: wrapCookieJarForRequest(options.cookieJar),\n    encoding: null,\n    headers: {\n      'User-Agent': options.userAgent,\n      'Accept-Language': 'en',\n      Accept: options.accept || '*/*',\n    },\n  };\n  if (options.referrer && !IS_BROWSER) {\n    requestOptions.headers.referer = options.referrer;\n  }\n  if (options.proxy) {\n    requestOptions.proxy = options.proxy;\n  }\n  Object.assign(requestOptions.headers, options.headers);\n\n  // NOTE: added 'UTF-8' as a default encoding\n  const { defaultEncoding = 'UTF-8', detectMetaCharset } = options;\n\n  const req = request(url, requestOptions, (error, response, bufferData) => {\n    if (!error) {\n      // If default encoding does not exist, pass on binary data.\n      if (defaultEncoding) {\n        const contentType =\n          parseContentType(response.headers['content-type']) || parseContentType('text/plain');\n        const sniffOptions = {\n          transportLayerEncodingLabel: contentType.get('charset'),\n          defaultEncoding,\n        };\n\n        const encoding = detectMetaCharset\n          ? sniffHTMLEncoding(bufferData, sniffOptions)\n          : whatwgEncoding.getBOMEncoding(bufferData) ||\n            whatwgEncoding.labelToName(contentType.get('charset')) ||\n            defaultEncoding;\n        const decoded = whatwgEncoding.decode(bufferData, encoding);\n\n        contentType.set('charset', encoding);\n        response.headers['content-type'] = contentType.toString();\n\n        callback(null, decoded, response);\n      } else {\n        callback(null, bufferData, response);\n      }\n    } else {\n      callback(error, null, response);\n    }\n  });\n\n  logRequest(req);\n\n  return {\n    originalRequest: req,\n    abort() {\n      req.abort();\n      const error = new Error('request canceled by user');\n      error.isAbortError = true;\n      callback(error);\n    },\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/resource-loader.js","module.exports = require(\"apollo-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"apollo-fetch\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/object/assign\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/assign\"\n// module id = 22\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/object/keys\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/keys\"\n// module id = 23\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/object/values\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/values\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/slicedToArray\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/slicedToArray\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/toConsumableArray\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/toConsumableArray\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"content-type-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"content-type-parser\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"html-encoding-sniffer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"html-encoding-sniffer\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"isomorphic-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-fetch\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"jsdom\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsdom\"\n// module id = 30\n// module chunks = 0","module.exports = require(\"jsdom/lib/jsdom/browser/resource-loader\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsdom/lib/jsdom/browser/resource-loader\"\n// module id = 31\n// module chunks = 0","module.exports = require(\"jsdom/lib/old-api\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsdom/lib/old-api\"\n// module id = 32\n// module chunks = 0","module.exports = require(\"jsonfile\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonfile\"\n// module id = 33\n// module chunks = 0","module.exports = require(\"localtunnel\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"localtunnel\"\n// module id = 34\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 35\n// module chunks = 0","module.exports = require(\"progress\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"progress\"\n// module id = 36\n// module chunks = 0","module.exports = require(\"request\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"request\"\n// module id = 37\n// module chunks = 0","module.exports = require(\"util\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"util\"\n// module id = 38\n// module chunks = 0","module.exports = require(\"whatwg-encoding\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"whatwg-encoding\"\n// module id = 39\n// module chunks = 0"],"sourceRoot":""}