{"version":3,"sources":["webpack:///webpack/bootstrap 8819d52d951bad2fe686","webpack:///external \"babel-runtime/regenerator\"","webpack:///external \"babel-runtime/helpers/asyncToGenerator\"","webpack:///external \"babel-runtime/core-js/promise\"","webpack:///external \"denodeify\"","webpack:///external \"babel-runtime/core-js/json/stringify\"","webpack:///external \"debug\"","webpack:///external \"babel-runtime/helpers/toConsumableArray\"","webpack:///external \"babel-runtime/helpers/classCallCheck\"","webpack:///external \"babel-runtime/helpers/createClass\"","webpack:///external \"babel-runtime/helpers/extends\"","webpack:///external \"child_process\"","webpack:///./src/tester/index.js","webpack:///external \"node-ask\"","webpack:///external \"tree-kill\"","webpack:///external \"env-ci\"","webpack:///./src/tester/runtimes.js","webpack:///external \"babel-runtime/core-js/object/keys\"","webpack:///external \"jsdom\"","webpack:///./src/tester/start-app.js","webpack:///external \"isomorphic-fetch\"","webpack:///./src/lib/tunnel.js","webpack:///external \"localtunnel\"","webpack:///./src/tester/package-json.js","webpack:///external \"babel-runtime/core-js/object/values\"","webpack:///external \"path\"","webpack:///external \"jsonfile\"","webpack:////home/circleci/chromatic/lib/util/GraphQLClient.js","webpack:///external \"apollo-fetch\"","webpack:///./src/tester/git.js","webpack:///external \"babel-runtime/helpers/slicedToArray\"","webpack:///./package.json","webpack:///./src/assets/environment.js"],"names":["client","variables","runQuery","TesterBuildQuery","build","app","debug","status","inProgressCount","specCount","changeCount","errorCount","lastInProgressCount","log","pluralize","setTimeout","resolve","BUILD_POLL_INTERVAL","waitForBuild","TesterCreateAppTokenMutation","TesterCreateBuildMutation","msg","console","n","noun","noNumber","pluralizedNoun","appCode","scriptName","noStart","port","appPath","url","only","autoAcceptChanges","exitZeroOnChanges","verbose","indexUrl","tunnelUrl","createTunnel","originalArgv","uri","Error","jwtToken","createAppToken","setJwtToken","message","match","commit","committedAt","committerEmail","committerName","branch","isTravisPrBuild","process","env","TRAVIS_EVENT_TYPE","TRAVIS_PULL_REQUEST_SHA","TRAVIS_PULL_REQUEST_BRANCH","BRANCH","baselineCommits","appPathWithSlash","appUrl","child","isolatorUrl","tunnel","predicate","name","componentName","otherComponentName","component","runtimeSpecs","filter","length","fromCI","CI","REPOSITORY_URL","exitCode","input","packageVersion","createBuild","number","componentCount","webUrl","onlineHint","buildNumber","buildAutoAcceptChanges","close","pid","scriptCommand","slice","join","replace","confirmed","runTest","addShimsToJSDOM","dom","Object","defineProperty","window","value","matches","addListener","removeListener","LocalStorageMock","store","key","toString","WorkerMock","getRandomValues","logs","virtualConsole","forEach","on","logType","push","sendTo","fromURL","userAgent","runScripts","resources","pretendToBeVisual","reject","document","addEventListener","separator","__chromaticRuntimeSpecs__","__STORYBOOK_CLIENT_API__","error","find","specs","getStorybook","map","kind","stories","runtime","reduce","a","b","getRuntimeSpecs","checkResponse","timeoutAt","Date","now","TIMEOUT","resolved","check","CHECK_EVERY","output","stderr","e","stdout","o","waitForResponse","NODE_ENV","BROWSER","startApp","local_host","host","openTunnel","checkPackageJson","addScriptToPackageJson","appDir","cwd","packageJson","scripts","script","filename","spaces","GraphQLClient","headers","apolloFetch","use","next","options","authorization","query","data","errors","command","trim","execGitCommand","split","committedAtSeconds","getCommit","getBranch","commitExists","limit","firstCommittedAtSeconds","commitsWithBuilds","commitsWithoutBuilds","commitsForCLI","c","commits","includes","nextCommits","parentCommits","maxCommits","maximallyDescendentCommits","candidateCommits","TesterHasBuildsWithCommitsQuery","newCommitsWithBuilds","hasBuildsWithCommits","newCommitsWithoutBuilds","step","TesterFirstCommittedAtQuery","firstBuild","lastBuild","initialCommitsWithBuilds","extraBaselineCommits","FETCH_N_INITIAL_BUILD_COMMITS","getBaselineCommits","CHROMATIC_SERVER_PORT","CHROMATIC_INDEX_URL","CHROMATIC_TUNNEL_URL","CHROMATIC_CREATE_TUNNEL","CHROMATIC_APP_CODE"],"mappings":"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","file":"dist/tester.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"dist\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 11);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 8819d52d951bad2fe686","module.exports = require(\"babel-runtime/regenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/regenerator\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/asyncToGenerator\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/asyncToGenerator\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/promise\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"denodeify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"denodeify\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/json/stringify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/json/stringify\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"debug\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"debug\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/toConsumableArray\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/toConsumableArray\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/classCallCheck\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/classCallCheck\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/createClass\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/createClass\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/extends\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/extends\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"child_process\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"child_process\"\n// module id = 10\n// module chunks = 0","import denodeify from 'denodeify';\nimport { confirm } from 'node-ask';\nimport setupDebug from 'debug';\nimport kill from 'tree-kill';\nimport envCi from 'env-ci';\n\nimport getRuntimeSpecs from './runtimes';\nimport startApp, { checkResponse } from './start-app';\nimport openTunnel from '../lib/tunnel';\nimport { checkPackageJson, addScriptToPackageJson } from './package-json';\nimport GraphQLClient from '../../../../lib/util/GraphQLClient';\nimport { getBaselineCommits, getCommit, getBranch } from './git';\nimport { version as packageVersion } from '../../package.json';\nimport { CHROMATIC_INDEX_URL, CHROMATIC_TUNNEL_URL } from '../assets/environment';\n\nconst BUILD_POLL_INTERVAL = 1000;\n\nconst TesterCreateAppTokenMutation = `\n  mutation TesterCreateAppTokenMutation($appCode: String!) {\n    createAppToken(code: $appCode)\n  }\n`;\n\nconst TesterCreateBuildMutation = `\n  mutation TesterCreateBuildMutation($input: CreateBuildInput!, $isolatorUrl: String!) {\n    createBuild(input: $input, isolatorUrl: $isolatorUrl) {\n      id\n      number\n      specCount\n      componentCount\n      webUrl\n    }\n  }\n`;\n\nconst TesterBuildQuery = `\n  query TesterBuildQuery($buildNumber: Int!) {\n    app {\n      build(number: $buildNumber) {\n        id\n        status\n        autoAcceptChanges\n        inProgressCount: snapshotCount(statuses: [SNAPSHOT_IN_PROGRESS])\n        specCount\n        changeCount: snapshotCount(statuses: [SNAPSHOT_PENDING, SNAPSHOT_ACCEPTED, SNAPSHOT_DENIED])\n        errorCount: snapshotCount(statuses: [SNAPSHOT_CAPTURE_ERROR])\n      }\n    }\n  }\n`;\n\nconst debug = setupDebug('react-chromatic:tester');\n\nfunction log(msg) {\n  // eslint-disable-next-line no-console\n  console.log(`Chromatic Tester: ${msg}`);\n}\n\nfunction pluralize(n, noun, noNumber) {\n  const pluralizedNoun = n === 1 ? noun : `${noun}s`;\n\n  return noNumber ? pluralizedNoun : `${n} ${pluralizedNoun}`;\n}\n\nlet lastInProgressCount;\nasync function waitForBuild(client, variables) {\n  const { app: { build } } = await client.runQuery(TesterBuildQuery, variables);\n  debug(`build:${JSON.stringify(build)}`);\n  const { status, inProgressCount, specCount, changeCount, errorCount } = build;\n  if (status === 'BUILD_IN_PROGRESS') {\n    if (inProgressCount !== lastInProgressCount) {\n      lastInProgressCount = inProgressCount;\n      log(\n        `${inProgressCount}/${pluralize(specCount, 'spec')} remain to test. ` +\n          `(${pluralize(changeCount, 'change')}, ${pluralize(errorCount, 'error')})`\n      );\n    }\n\n    await new Promise(resolve => setTimeout(resolve, BUILD_POLL_INTERVAL));\n    return waitForBuild(client, variables);\n  }\n  return build;\n}\n\nexport default async function runTest({\n  appCode,\n  scriptName,\n  noStart = false,\n  port,\n  appPath = '/',\n  url,\n  only,\n  autoAcceptChanges = false,\n  exitZeroOnChanges = false,\n  verbose = false,\n  indexUrl = CHROMATIC_INDEX_URL,\n  tunnelUrl = CHROMATIC_TUNNEL_URL,\n  createTunnel = true,\n  originalArgv = false,\n}) {\n  const uri = `${indexUrl}/graphql`;\n  const client = new GraphQLClient({ uri });\n\n  if (!appCode) {\n    throw new Error(\n      'You must provide an app code  -- visit https://www.chromaticqa.com to get your code.' +\n        `\\nPass your app code with the \\`CHROMATIC_APP_CODE\\` environment variable or the \\`--app-code\\` flag.`\n    );\n  }\n\n  if (((!scriptName && !noStart) || !port) && !url) {\n    throw new Error(\n      'You must provide a npm script name (`--script-name`) and port (`--port`) so we can start your app'\n    );\n  }\n\n  try {\n    const { createAppToken: jwtToken } = await client.runQuery(TesterCreateAppTokenMutation, {\n      appCode,\n    });\n    client.setJwtToken(jwtToken);\n  } catch (errors) {\n    if (errors[0] && errors[0].message && errors[0].message.match('No app with code')) {\n      throw new Error(\n        `Incorrect app code '${appCode}' -- visit https://www.chromaticqa.com to get your code`\n      );\n    }\n    throw errors;\n  }\n\n  // eslint-disable-next-line prefer-const\n  let { commit, committedAt, committerEmail, committerName } = await getCommit();\n  let branch = await getBranch();\n  const isTravisPrBuild = process.env.TRAVIS_EVENT_TYPE === 'pull_request';\n\n  // Travis PR builds are weird, we want to ensure we mark build against the commit that was\n  // merged from, rather than the resulting \"psuedo\" merge commit that doesn't stick around in the\n  // history of the project (so approvals will get lost). We also have to ensure we use the right branch.\n  if (isTravisPrBuild) {\n    commit = process.env.TRAVIS_PULL_REQUEST_SHA;\n    branch = process.env.TRAVIS_PULL_REQUEST_BRANCH;\n  }\n\n  // On certain CI systems, a branch is not checked out (instead a detached head) is used for the commit.\n  if (branch === 'HEAD') {\n    // $BRANCH is for netlify: https://www.netlify.com/docs/continuous-deployment/\n    branch = envCi().branch || process.env.BRANCH || branch;\n  }\n\n  debug(`git info: ${JSON.stringify({ commit, committedAt, branch })}`);\n\n  const baselineCommits = await getBaselineCommits(client);\n  debug(`Found baselineCommits: ${baselineCommits}`);\n\n  const appPathWithSlash = appPath[0] === '/' ? appPath : `/${appPath}`;\n  const appUrl = url || `http://localhost:${port}${appPathWithSlash}`;\n  let child;\n  if (!noStart && !url) {\n    log(`Starting app with \\`npm run ${scriptName}\\``);\n    child = await startApp({ scriptName, url: appUrl });\n    log(`Started app on port ${port}`);\n  } else {\n    if (!await checkResponse(appUrl)) {\n      throw new Error(`No server responding at ${appUrl} -- make sure you've started it.`);\n    }\n    log(`Detected app on port ${port}`);\n  }\n\n  let isolatorUrl = appUrl;\n  let tunnel;\n  if (createTunnel && !url) {\n    log(`Opening tunnel to Chromatic capture servers`);\n    tunnel = await openTunnel({ tunnelUrl, port });\n    debug(`Opened tunnel to ${tunnel.url}`);\n    isolatorUrl = `${tunnel.url}${appPathWithSlash}`;\n  }\n\n  debug(`Connecting to ${isolatorUrl}`);\n  log(`Uploading and verifying build (this may take a few minutes depending on your connection)`);\n\n  let predicate = () => true;\n  if (only) {\n    const match = only.match(/(.*):([^:]*)/);\n    if (!match) {\n      throw new Error(`--only argument must provided in the from \"componentName:specName\"`);\n    }\n    log(`Running only spec '${match[2]}' of component '${match[1]}'`);\n\n    predicate = ({ name, componentName, component: { name: otherComponentName } }) =>\n      name === match[2] && (componentName || otherComponentName) === match[1];\n  }\n\n  const runtimeSpecs = (await getRuntimeSpecs(isolatorUrl, { verbose })).filter(predicate);\n\n  if (runtimeSpecs.length === 0) {\n    throw new Error('Cannot run a build with no specs. Please add some specs!');\n  }\n\n  log(`Found ${runtimeSpecs.length} specs`);\n\n  // REPOSITORY_URL is for netlify: https://www.netlify.com/docs/continuous-deployment/\n  const fromCI = !!process.env.CI || !!process.env.REPOSITORY_URL;\n  debug(`Detected build fromCI:${fromCI}`);\n  debug(`Detected package version:${packageVersion}`);\n\n  let exitCode = 5;\n  try {\n    const { createBuild: { number, specCount, componentCount, webUrl } } = await client.runQuery(\n      TesterCreateBuildMutation,\n      {\n        input: {\n          autoAcceptChanges,\n          branch,\n          commit,\n          committedAt,\n          baselineCommits,\n          runtimeSpecs,\n          fromCI,\n          isTravisPrBuild,\n          packageVersion,\n          committerEmail,\n          committerName,\n        },\n        isolatorUrl,\n      }\n    );\n\n    const onlineHint = `View it online at ${webUrl}`;\n    log(\n      `Started Build ${number} ` +\n        `(${pluralize(componentCount, 'component')}, ${pluralize(specCount, 'spec')}).\n\n${onlineHint}.`\n    );\n\n    const {\n      status,\n      autoAcceptChanges: buildAutoAcceptChanges, // if it is the first build, this may have been set\n      changeCount,\n      errorCount,\n    } = await waitForBuild(client, {\n      buildNumber: number,\n    });\n\n    switch (status) {\n      case 'BUILD_PASSED':\n        log(`Build ${number} passed! ${onlineHint}.`);\n        exitCode = 0;\n        break;\n      // They may have sneakily looked at the build while we were waiting\n      case 'BUILD_ACCEPTED':\n      case 'BUILD_PENDING':\n      case 'BUILD_DENIED':\n        log(`Build ${number} has ${pluralize(changeCount, 'change')}. ${onlineHint}.`);\n        exitCode = exitZeroOnChanges || buildAutoAcceptChanges ? 0 : 1;\n        if (exitCode !== 0) {\n          log(`Pass --exit-zero-on-changes if you want this command to exit successfully in this case.\n  Alternatively, pass --auto-accept-changes if you want changed builds to pass on this branch.\n  Read more: http://docs.chromaticqa.com/test`);\n        }\n        break;\n      case 'BUILD_FAILED':\n        log(`Build ${number} has ${pluralize(errorCount, 'error')}. ${onlineHint}.`);\n        exitCode = 2;\n        break;\n      case 'BUILD_TIMED_OUT':\n        log(\n          `Build ${number} has timed out. Ensure your machine is connected to the internet and please try again.`\n        );\n        exitCode = 3;\n        break;\n      case 'BUILD_ERROR':\n        log(`Build ${number} has failed to run. Our apologies. Please try again.`);\n        exitCode = 4;\n        break;\n      default:\n        throw new Error(`Unexpected build status: ${status}`);\n    }\n  } catch (e) {\n    if (e.length && e[0] && e[0].message.match(/Cannot run a build with no specs./)) {\n      log(e[0].message);\n      exitCode = 255;\n    } else {\n      throw e;\n    }\n  } finally {\n    if (tunnel) {\n      tunnel.close();\n    }\n    if (child) {\n      await denodeify(kill)(child.pid, 'SIGHUP');\n    }\n  }\n\n  if (!checkPackageJson() && originalArgv) {\n    const scriptCommand = `chromatic test ${originalArgv.slice(2).join(' ')}`.replace(\n      /--app-code[= ]\\S+/,\n      ''\n    );\n\n    const confirmed = await confirm(\n      \"\\nYou have not added Chromatic's test script to your `package.json`. Would you like me to do it for you?\"\n    );\n    if (confirmed) {\n      addScriptToPackageJson('chromatic', scriptCommand);\n      // eslint-disable-next-line no-console\n      console.log(\n        '\\nAdded script `chromatic`. You can now run it here or in CI with `npm run chromatic` (or `yarn chromatic`)'\n      );\n    } else {\n      // eslint-disable-next-line no-console\n      console.log(`\nNo problem. You can add it later with:\n{\n  \"scripts\": {\n    \"chromatic\": \"${scriptCommand}\"\n  }\n}`);\n    }\n\n    // eslint-disable-next-line no-console\n    console.log(\n      `\\nMake sure you set the \\`CHROMATIC_APP_CODE\\` environment variable when running builds (in particular on your CI server).`\n    );\n  }\n\n  return exitCode;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/index.js","module.exports = require(\"node-ask\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-ask\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"tree-kill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"tree-kill\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"env-ci\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"env-ci\"\n// module id = 14\n// module chunks = 0","/* eslint-disable no-console, class-methods-use-this */\nimport { JSDOM, VirtualConsole } from 'jsdom';\n\nfunction addShimsToJSDOM(dom) {\n  Object.defineProperty(dom.window, 'matchMedia', {\n    value: () => ({\n      matches: true,\n      addListener: () => {},\n      removeListener: () => {},\n    }),\n  });\n\n  class LocalStorageMock {\n    constructor() {\n      this.store = {};\n    }\n    getItem(key) {\n      return this.store[key];\n    }\n    removeItem(key) {\n      delete this.store[key];\n    }\n    setItem(key, value) {\n      this.store[key] = value.toString();\n    }\n    clear() {\n      this.store = {};\n    }\n  }\n  Object.defineProperty(dom.window, 'localStorage', {\n    value: new LocalStorageMock(),\n  });\n\n  class WorkerMock {\n    addEventListener() {}\n    removeEventLister() {}\n    postMessage() {}\n    terminate() {}\n  }\n  Object.defineProperty(dom.window, 'Worker', WorkerMock);\n\n  Object.defineProperty(dom.window, 'crypto', {\n    value: {\n      getRandomValues: () => 0,\n    },\n  });\n}\n\nexport default async function getRuntimeSpecs(url, { verbose = false } = {}) {\n  const logs = [];\n  const virtualConsole = new VirtualConsole();\n  Object.keys(console).forEach(logType => {\n    virtualConsole.on(logType, log => logs.push({ logType, log }));\n  });\n  virtualConsole.on('jsdomError', log => logs.push({ logType: 'error', log }));\n\n  if (verbose) {\n    virtualConsole.sendTo(console);\n  }\n\n  const dom = await JSDOM.fromURL(url, {\n    userAgent: 'Chromatic',\n    // We need to execute the scripts on the page\n    runScripts: 'dangerously',\n    // We need to load scripts that are loaded via script tags\n    resources: 'usable',\n    // Send console.logs -> /dev/null (so to speak)\n    virtualConsole,\n    // Add a requestAnimationFrame polyfill, react@16 warns about it\n    pretendToBeVisual: true,\n  });\n\n  // NOTE: this line runs immediately after the HTML for the page has been loaded\n  // it's not possible that any external script tags have been executed.\n  // It is possible that they have a <script> tag that need these shims, but\n  // I highly doubt it. If we run into this we can always use JSDOM's old API\n  // to inject our own scripts at 'create' time\n  addShimsToJSDOM(dom);\n\n  return new Promise((resolve, reject) =>\n    dom.window.document.addEventListener('DOMContentLoaded', () => {\n      const separator = '=========================';\n\n      if (!dom.window.__chromaticRuntimeSpecs__ && !dom.window.__STORYBOOK_CLIENT_API__) {\n        console.error(\n          `Didn't find 'window.__chromaticRuntimeSpecs__' at ${url}.\\n` +\n            `Have you installed the Chromatic widget or addon correctly?\\n`\n        );\n\n        if (!verbose && logs.length) {\n          console.error(`Your app's output:\\n${separator}\\n`);\n          logs.forEach(({ logType, log }) => console[logType](log));\n          console.error(`\\n${separator}\\n`);\n        }\n        reject(new Error(`Didn't find 'window.__chromaticRuntimeSpecs__' at ${url}.`));\n      }\n\n      // If their app logged something to console.error, it's probably, but\n      // not definitely an issue. See https://github.com/hichroma/chromatic/issues/757\n      if (logs.find(log => log.logType === 'error')) {\n        console.error(`\\nYour app logged the following to the error console:\\n${separator}`);\n        logs\n          .filter(log => log.logType === 'error')\n          .forEach(({ logType, log }) => console[logType](log));\n        console.error(\n          `\\n${separator}\\nThis may lead to some stories not working right or getting detected by Chromatic` +\n            `\\nWe suggest you fix the errors, but we will continue anyway..\\n`\n        );\n      }\n\n      let specs;\n      if (dom.window.__chromaticRuntimeSpecs__) {\n        specs = dom.window.__chromaticRuntimeSpecs__();\n      } else {\n        specs = dom.window.__STORYBOOK_CLIENT_API__\n          .getStorybook()\n          .map(({ kind, stories }) =>\n            stories.map(({ name }) => ({\n              runtime: 'storybook-no-addon',\n              component: { name: kind },\n              name,\n              input: JSON.stringify({ kind, name }),\n            }))\n          )\n          .reduce((a, b) => [...a, ...b], []);\n      }\n\n      dom.window.close();\n      resolve(specs);\n    })\n  );\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/runtimes.js","module.exports = require(\"babel-runtime/core-js/object/keys\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/keys\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"jsdom\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsdom\"\n// module id = 17\n// module chunks = 0","import { spawn } from 'child_process';\nimport fetch from 'isomorphic-fetch';\n\nconst CHECK_EVERY = 1000;\nconst TIMEOUT = 5 * 60 * 1000;\n\nexport async function checkResponse(url) {\n  try {\n    await fetch(url);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nasync function waitForResponse(child, url) {\n  const timeoutAt = Date.now() + TIMEOUT;\n  return new Promise((resolve, reject) => {\n    let resolved = false;\n    async function check() {\n      if (Date.now() > timeoutAt) {\n        resolved = true;\n        reject(new Error(`No server responding at ${url} within ${TIMEOUT / 1000} seconds.`));\n        return;\n      }\n\n      if (await checkResponse(url)) {\n        resolved = true;\n        resolve();\n        return;\n      }\n      setTimeout(check, CHECK_EVERY);\n    }\n    check();\n\n    if (child) {\n      let output = '';\n      child.stderr.on('data', e => {\n        output += e.toString();\n      });\n      child.stdout.on('data', o => {\n        output += o.toString();\n      });\n\n      child.on('close', () => {\n        if (!resolved) {\n          reject(new Error(`Script failed to start: ${output}\\n`));\n        }\n      });\n    }\n  });\n}\n\nexport default async function startApp({ scriptName = 'start', url }) {\n  let child;\n  if (scriptName !== 'none') {\n    if (await checkResponse(url)) {\n      throw new Error(\n        `Detected process already running at ${url}` +\n          `\\nIf you are sure this is your server, pass \\`--do-not-start\\` to skip this step.`\n      );\n    }\n\n    child = spawn('npm', ['run', scriptName], {\n      env: {\n        ...process.env,\n        NODE_ENV: 'development',\n        BROWSER: 'none',\n      },\n    });\n  }\n\n  await waitForResponse(child, url);\n  return child;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/start-app.js","module.exports = require(\"isomorphic-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"isomorphic-fetch\"\n// module id = 19\n// module chunks = 0","import localtunnel from 'localtunnel';\nimport denodeify from 'denodeify';\n\nexport default async function openTunnel({ tunnelUrl, port }) {\n  if (!port) {\n    throw new Error('Need to pass a port into `openTunnel`');\n  }\n\n  return denodeify(localtunnel)(port, {\n    local_host: 'localhost',\n    host: tunnelUrl,\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/tunnel.js","module.exports = require(\"localtunnel\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"localtunnel\"\n// module id = 21\n// module chunks = 0","import path from 'path';\nimport { readFileSync, writeFileSync } from 'jsonfile';\n\nexport function checkPackageJson({ appDir = process.cwd() } = {}) {\n  const packageJson = readFileSync(path.resolve(appDir, './package.json'));\n\n  return Object.values(packageJson.scripts || {}).find(script => script.match('chromatic test'));\n}\n\nexport function addScriptToPackageJson(scriptName, scriptCommand, { appDir = process.cwd() } = {}) {\n  const filename = path.resolve(appDir, './package.json');\n  const packageJson = readFileSync(filename);\n\n  if (packageJson[scriptName]) {\n    throw new Error(`Script named '${scriptName}' already exists in package.json`);\n  }\n\n  if (!packageJson.scripts) {\n    packageJson.scripts = {};\n  }\n  packageJson.scripts[scriptName] = scriptCommand;\n  writeFileSync(filename, packageJson, { spaces: 2 });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/package-json.js","module.exports = require(\"babel-runtime/core-js/object/values\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/object/values\"\n// module id = 23\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"jsonfile\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonfile\"\n// module id = 25\n// module chunks = 0","import { createApolloFetch } from 'apollo-fetch';\n\nexport default class GraphQLClient {\n  constructor({ uri, jwtToken, headers }) {\n    this.apolloFetch = createApolloFetch({ uri });\n    this.headers = headers;\n\n    if (jwtToken) {\n      this.setJwtToken(jwtToken);\n    }\n  }\n\n  setJwtToken(jwtToken) {\n    this.apolloFetch.use(({ options }, next) => {\n      if (jwtToken) {\n        // eslint-disable-next-line no-param-reassign\n        options.headers = {\n          ...options.headers,\n          ...this.headers,\n          authorization: `bearer ${jwtToken}`,\n        };\n      }\n\n      next();\n    });\n  }\n\n  async runQuery(query, variables) {\n    const { data, errors } = await this.apolloFetch({ query, variables });\n    if (errors) {\n      throw errors;\n    }\n    return data;\n  }\n\n  // Convenience static method\n  static async runQuery(options, query, variables) {\n    return new GraphQLClient(options).runQuery(query, variables);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// /home/circleci/chromatic/lib/util/GraphQLClient.js","module.exports = require(\"apollo-fetch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"apollo-fetch\"\n// module id = 27\n// module chunks = 0","import { exec } from 'child_process';\nimport denodeify from 'denodeify';\nimport setupDebug from 'debug';\n\nconst debug = setupDebug('react-chromatic:tester:git');\n\nasync function execGitCommand(command) {\n  try {\n    return (await denodeify(exec)(command)).trim();\n  } catch (error) {\n    if (error.message && error.message.match('Not a git repository')) {\n      // eslint-disable-next-line no-console\n      console.error(`Unable to execute git command '${command}'.\\n`);\n      // eslint-disable-next-line no-console\n      console.error(\n        'Chromatic only works in git projects.\\n' +\n          'Contact us at support@hichroma.com if you need to use Chromatic outside of one.\\n\\n'\n      );\n    }\n    throw error;\n  }\n}\n\nexport const FETCH_N_INITIAL_BUILD_COMMITS = 20;\n\nconst TesterFirstCommittedAtQuery = `\n  query TesterFirstCommittedAtQuery($branch: String!) {\n    app {\n      firstBuild(sortByCommittedAt: true) {\n        committedAt\n      }\n      lastBuild(branch: $branch, sortByCommittedAt: true) {\n        commit\n        committedAt\n      }\n    }\n  }\n`;\n\nconst TesterHasBuildsWithCommitsQuery = `\n  query TesterHasBuildsWithCommitsQuery($commits: [String!]!) {\n    app {\n      hasBuildsWithCommits(commits: $commits)\n    }\n  }\n`;\n\n// NOTE: At some point we should check that the commit has been pushed to the\n// remote and the branch matches with origin/REF, but for now we are naive about\n// adhoc builds.\n\n// We could cache this, but it's probably pretty quick\nexport async function getCommit() {\n  const [commit, committedAtSeconds, committerEmail, committerName] = (await execGitCommand(\n    `git log -n 1 --format=\"%H,%ct,%ce,%cn\"`\n  )).split(',');\n\n  return { commit, committedAt: committedAtSeconds * 1000, committerEmail, committerName };\n}\n\nexport async function getBranch() {\n  return execGitCommand(`git rev-parse --abbrev-ref HEAD`);\n}\n\n// Check if a commit exists in the repository\nasync function commitExists(commit) {\n  try {\n    await execGitCommand(`git cat-file -e ${commit}^{commit}`);\n    return true;\n  } catch (error) {\n    return false;\n  }\n}\n\nfunction commitsForCLI(commits) {\n  return commits.map(c => c.trim()).join(' ');\n}\n\n// git rev-list in a basic form gives us a list of commits reaching back to\n// `firstCommittedAtSeconds` (i.e. when the first build of this app happened)\n// in reverse chronological order.\n//\n// A simplified version of what we are doing here is just finding the first\n// commit in that list that has a build. We only want to send `limit` to\n// the server in this pass (although we may already know some commits that do\n// or do not have builds from earlier passes). So we just pick the first `limit`\n// commits from the command, filtering out `commitsWith[out]Builds`.\n//\n// However, it's not quite that simple -- because of branching. However,\n// passing commits after `--not` in to `git rev-list` *occludes* all the ancestors\n// of those commits. This is exactly what we need once we find one or more commits\n// that do have builds: a list of the ancestors of HEAD that are not accestors of\n// `commitsWithBuilds`.\n//\nasync function nextCommits(\n  limit,\n  { firstCommittedAtSeconds, commitsWithBuilds, commitsWithoutBuilds }\n) {\n  // We want the next limit commits that aren't \"covered\" by `commitsWithBuilds`\n  // This will print out all commits in `commitsWithoutBuilds` (except if they are covered),\n  // so we ask enough that we'll definitely get `limit` unknown commits\n  const command = `git rev-list HEAD \\\n      ${firstCommittedAtSeconds ? `--since ${firstCommittedAtSeconds}` : ''} \\\n      -n ${limit + commitsWithoutBuilds.length} --not ${commitsForCLI(commitsWithBuilds)}`;\n  debug(`running ${command}`);\n  const commits = (await execGitCommand(command)).split('\\n').filter(c => !!c);\n  debug(`command output: ${commits}`);\n\n  return (\n    commits\n      // No sense in checking commits we already know about\n      .filter(c => !commitsWithBuilds.includes(c))\n      .filter(c => !commitsWithoutBuilds.includes(c))\n      .slice(0, limit)\n  );\n}\n\n// Which of the listed commits are \"maximally descendent\":\n// ie c in commits such that there are no descendents of c in commits.\nasync function maximallyDescendentCommits(commits) {\n  if (commits.length === 0) {\n    return commits;\n  }\n\n  // <commit>^@ expands to all parents of commit\n  const parentCommits = commits.map(c => `${c}^@`);\n  // List the tree from <commits> not including the tree from <parentCommits>\n  // This just filters any commits that are ancestors of other commits\n  const command = `git rev-list ${commitsForCLI(commits)} --not ${commitsForCLI(parentCommits)}`;\n  debug(`running ${command}`);\n  const maxCommits = (await execGitCommand(command)).split('\\n').filter(c => !!c);\n  debug(`command output: ${maxCommits}`);\n\n  return maxCommits;\n}\n\n// Exponentially iterate `limit` up to infinity to find a \"covering\" set of commits with builds\nasync function step(\n  client,\n  limit,\n  { firstCommittedAtSeconds, commitsWithBuilds, commitsWithoutBuilds }\n) {\n  debug(`step: checking ${limit} up to ${firstCommittedAtSeconds}`);\n  debug(`step: commitsWithBuilds: ${commitsWithBuilds}`);\n  debug(`step: commitsWithoutBuilds: ${commitsWithoutBuilds}`);\n\n  const candidateCommits = await nextCommits(limit, {\n    firstCommittedAtSeconds,\n    commitsWithBuilds,\n    commitsWithoutBuilds,\n  });\n\n  debug(`step: candidateCommits: ${candidateCommits}`);\n\n  // No more commits uncovered commitsWithBuilds!\n  if (candidateCommits.length === 0) {\n    debug('step: no candidateCommits; we are done');\n    return commitsWithBuilds;\n  }\n\n  const { app: { hasBuildsWithCommits: newCommitsWithBuilds } } = await client.runQuery(\n    TesterHasBuildsWithCommitsQuery,\n    {\n      commits: candidateCommits,\n    }\n  );\n  debug(`step: newCommitsWithBuilds: ${newCommitsWithBuilds}`);\n\n  const newCommitsWithoutBuilds = candidateCommits.filter(\n    commit => !newCommitsWithBuilds.find(c => c === commit)\n  );\n\n  return step(client, limit * 2, {\n    firstCommittedAtSeconds,\n    commitsWithBuilds: [...commitsWithBuilds, ...newCommitsWithBuilds],\n    commitsWithoutBuilds: [...commitsWithoutBuilds, ...newCommitsWithoutBuilds],\n  });\n}\n\n// eslint-disable-next-line import/prefer-default-export\nexport async function getBaselineCommits(client) {\n  const branch = await getBranch();\n  const { committedAt } = await getCommit();\n\n  // Include the latest build from this branch as an ancestor of the current build\n  const { app: { firstBuild, lastBuild } } = await client.runQuery(TesterFirstCommittedAtQuery, {\n    branch,\n  });\n  debug(`App firstBuild: ${firstBuild}, lastBuild: ${lastBuild}`);\n\n  if (!firstBuild) {\n    debug('App has no builds, returning []');\n    return [];\n  }\n\n  const initialCommitsWithBuilds = [];\n  const extraBaselineCommits = [];\n\n  // Don't do any special branching logic for builds on `HEAD`, this is fairly meaningless\n  // (CI systems that have been pushed tags can not set a branch)\n  if (branch !== 'HEAD' && lastBuild && lastBuild.committedAt <= committedAt) {\n    if (await commitExists(lastBuild.commit)) {\n      initialCommitsWithBuilds.push(lastBuild.commit);\n    } else {\n      debug(`Last build commit not in index, blindly appending to baselines`);\n      extraBaselineCommits.push(lastBuild.commit);\n    }\n  }\n\n  // Get a \"covering\" set of commits that have builds. This is a set of commits\n  // such that any ancestor of HEAD is either:\n  //   - in commitsWithBuilds\n  //   - an ancestor of a commit in commitsWithBuilds\n  //   - has no build\n  const commitsWithBuilds = await step(client, FETCH_N_INITIAL_BUILD_COMMITS, {\n    firstCommittedAtSeconds: firstBuild.committedAt && firstBuild.committedAt / 1000,\n    commitsWithBuilds: initialCommitsWithBuilds,\n    commitsWithoutBuilds: [],\n  });\n\n  debug(`Final commitsWithBuilds: ${commitsWithBuilds}`);\n\n  // For any pair A,B of builds, there is no point in using B if it is an ancestor of A.\n  return [...extraBaselineCommits, ...(await maximallyDescendentCommits(commitsWithBuilds))];\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tester/git.js","module.exports = require(\"babel-runtime/helpers/slicedToArray\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/slicedToArray\"\n// module id = 29\n// module chunks = 0","module.exports = {\"name\":\"react-chromatic\",\"version\":\"0.8.2-beta.0\",\"description\":\"Visual Testing for React Components\",\"browser\":\"./dist/client.js\",\"main\":\"./dist/assets/null-server.js\",\"scripts\":{\"prebuild\":\"rm -rf ./dist\",\"build:bin\":\"../../node_modules/.bin/babel -s -d ./dist ./src -D --only 'assets,bin'\",\"build:webpack\":\"../../node_modules/.bin/webpack\",\"build\":\"../../node_modules/.bin/npm-run-all --serial -l build:**\",\"prepare\":\"npm run build\",\"dev\":\"../../node_modules/.bin/npm-run-all --parallel -l 'build:** -- --watch'\"},\"bin\":{\"chromatic\":\"./dist/bin/chromatic.js\"},\"dependencies\":{\"apollo-fetch\":\"^0.6.0\",\"babel-runtime\":\"^6.26.0\",\"commander\":\"^2.9.0\",\"debug\":\"^3.0.1\",\"denodeify\":\"^1.2.1\",\"ejson\":\"^2.1.2\",\"env-ci\":\"^1.5.0\",\"es6-error\":\"^4.0.2\",\"isomorphic-fetch\":\"^2.2.1\",\"jsdom\":\"^11.5.1\",\"jsonfile\":\"^4.0.0\",\"localtunnel\":\"^1.8.3\",\"node-ask\":\"^1.0.1\",\"tree-kill\":\"^1.1.0\"},\"peerDependencies\":{\"react\":\"15.x || 16.x\",\"react-dom\":\"15.x || 16.x\"},\"devDependencies\":{\"babel-cli\":\"^6.26.0\",\"npm-run-all\":\"^4.0.2\",\"prettier-eslint\":\"^7.1.0\",\"tmp\":\"^0.0.33\",\"webpack\":\"^3.10.0\",\"webpack-node-externals\":\"^1.6.0\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./package.json\n// module id = 30\n// module chunks = 0","// Note this file differs from our usual convention because it is packaged\nconst {\n  CHROMATIC_SERVER_PORT = 3004,\n  CHROMATIC_INDEX_URL = 'https://index.chromaticqa.com',\n  CHROMATIC_TUNNEL_URL = 'https://tunnel.chromaticqa.com',\n  CHROMATIC_CREATE_TUNNEL = 'true',\n  CHROMATIC_APP_CODE,\n} = process.env;\n\nexport {\n  CHROMATIC_SERVER_PORT,\n  CHROMATIC_INDEX_URL,\n  CHROMATIC_TUNNEL_URL,\n  CHROMATIC_CREATE_TUNNEL,\n  CHROMATIC_APP_CODE,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/assets/environment.js"],"sourceRoot":""}